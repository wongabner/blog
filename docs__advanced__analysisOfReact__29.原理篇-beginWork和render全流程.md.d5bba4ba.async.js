(self["webpackChunkblog"]=self["webpackChunkblog"]||[]).push([[686],{48117:function(e,n,t){"use strict";t.r(n);var l=t(67294),r=t(96089),c=t(65659),a=l.memo((e=>{e.demos;return l.createElement(l.Fragment,null,l.createElement("div",{className:"markdown"},l.createElement("h2",{id:"\u4e00-\u524d\u8a00"},l.createElement(r.AnchorLink,{to:"#\u4e00-\u524d\u8a00","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e00 \u524d\u8a00"),l.createElement("p",null,"\u5728 fiber \u7ae0\u8282\u4ecb\u7ecd\u8fc7\uff0c\u5f53\u7ec4\u4ef6\u66f4\u65b0\uff0c\u672c\u8d28\u4e0a\u662f\u4ece fiberRoot \u5f00\u59cb\u6df1\u5ea6\u8c03\u548c fiber \u6811\u3002\u90a3\u4e48\u672c\u7ae0\u8282\u5c06\u7ee7\u7eed\u56f4\u7ed5 React \u8c03\u548c\u6d41\u7a0b\u3002\u4ecb\u7ecd\u4e00\u4e0b\u8c03\u548c\u6d41\u7a0b\uff0c\u9996\u5148\u601d\u8003\u51e0\u4e2a\u95ee\u9898\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u7ec4\u4ef6 A \u89e6\u53d1 ",l.createElement("code",null,"setState")," \u6216\u8005 ",l.createElement("code",null,"useState")," \u66f4\u65b0\u89c6\u56fe\uff0c\u65e2\u7136 ",l.createElement("code",null,"fiber")," \u662f\u4ece root \u5f00\u59cb\u66f4\u65b0\uff0c\u90a3\u4e48\u5982\u4f55\u627e\u5230\u5bf9\u5e94\u7684 A \u5e76 rerender \u7684\u5462\uff1f"),l.createElement("li",null,"\u7ec4\u4ef6\u7c7b\u578b fiber \u8fdb\u884c ",l.createElement("code",null,"beginWork")," \u5c31\u4e00\u5b9a\u4f1a\u8fdb\u884c ",l.createElement("code",null,"render")," \u5417\uff1f")),l.createElement("h2",{id:"\u4e8c-state-\u66f4\u65b0\u6e90\u6cc9"},l.createElement(r.AnchorLink,{to:"#\u4e8c-state-\u66f4\u65b0\u6e90\u6cc9","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e8c state \u66f4\u65b0\u6e90\u6cc9"),l.createElement("h3",{id:"1-\u66f4\u65b0\u7684\u6700\u5c0f\u5355\u5143"},l.createElement(r.AnchorLink,{to:"#1-\u66f4\u65b0\u7684\u6700\u5c0f\u5355\u5143","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"1 \u66f4\u65b0\u7684\u6700\u5c0f\u5355\u5143"),l.createElement("p",null,"\u867d\u7136\u5728 ReactV18 \u5f15\u5165\u8ba2\u9605\u5916\u90e8\u6570\u636e\u6e90\u7684 ",l.createElement("code",null,"useMutableSource"),"\u3002\u4f46\u5728\u5f53\u524d\u7248\u672c\u7684 React \u4e2d\uff0c\u89c6\u56fe\u7684\u66f4\u65b0\u57fa\u672c\u90fd\u6765\u6e90\u4e8e\u5185\u90e8 state \u7684\u6539\u53d8\u3002\u5982\u679c\u6709\u4e00\u4e2a\u7ec4\u4ef6 A \uff0c\u5982\u679c\u60f3\u8981\u5b83\u66f4\u65b0\uff0c\u90a3\u4e48\u573a\u666f\u6709\u5982\u4e0b\u60c5\u51b5\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u7ec4\u4ef6\u672c\u8eab\u6539\u53d8 ",l.createElement("code",null,"state")," \u3002\u51fd\u6570 ",l.createElement("code",null,"useState")," | ",l.createElement("code",null,"useReducer")," \uff0c\u7c7b\u7ec4\u4ef6 ",l.createElement("code",null,"setState")," | ",l.createElement("code",null,"forceUpdate"),"\u3002"),l.createElement("li",null,l.createElement("code",null,"props")," \u6539\u53d8\uff0c\u7531\u7ec4\u4ef6\u66f4\u65b0\u5e26\u6765\u7684\u5b50\u7ec4\u4ef6\u7684\u66f4\u65b0\u3002"),l.createElement("li",null,l.createElement("code",null,"context"),"\u66f4\u65b0\uff0c\u5e76\u4e14\u8be5\u7ec4\u4ef6\u6d88\u8d39\u4e86\u5f53\u524d ",l.createElement("code",null,"context")," \u3002")),l.createElement("p",null,"\u65e0\u8bba\u662f\u4e0a\u9762\u54ea\u79cd\u65b9\u5f0f\uff0c\u672c\u8d28\u4e0a\u90fd\u662f state \u7684\u53d8\u5316\u3002"),l.createElement("ul",null,l.createElement("li",null,"props \u6539\u53d8\u6765\u6e90\u4e8e\u7236\u7ea7\u7ec4\u4ef6\u7684 state \u53d8\u5316\u3002"),l.createElement("li",null,"context \u53d8\u5316\u6765\u6e90\u4e8e ",l.createElement("code",null,"Provider")," \u4e2d value \u53d8\u5316\uff0c\u800c value \u4e00\u822c\u60c5\u51b5\u4e0b\u4e5f\u662f state \u6216\u8005\u662f state \u884d\u751f\u4ea7\u7269\u3002")),l.createElement("p",null,l.createElement("code",null,"state")," \u6539\u53d8\u662f\u5728\u7ec4\u4ef6\u5bf9\u5e94\u7684 fiber \u5355\u4f4d\u4e0a\u7684\uff0c\u4e4b\u524d\u7684 fiber \u7ae0\u8282\u8bb2\u5230\u4e86\u5728 React \u7684\u4e16\u754c\u91cc\u4f1a\u5b58\u5728\u591a\u79cd\u591a\u6837\u7684 fiber \u7c7b\u578b\uff0c \u800c\u5f00\u53d1\u8005\u5e73\u65f6\u4f7f\u7528\u7684\u7ec4\u4ef6 ",l.createElement("code",null,"function Component")," \u6216\u8005 ",l.createElement("code",null,"Class Component")," \u4e5f\u662f\u4e24\u79cd\u4e0d\u540c\u7684 fiber \u7c7b\u578b\u3002\u800c\u4e14 React \u5e95\u5c42\u5bf9\u5b83\u4eec\u7684\u5904\u7406\u903b\u8f91\u4e5f\u4e0d\u76f8\u540c\u3002"),l.createElement("ul",null,l.createElement("li",null,"\u6bd4\u5982\u66f4\u65b0\u7c7b\u7ec4\u4ef6\u7528\u7684\u662f ",l.createElement("code",null,"updateClassComponent"),"\uff0c\u5b83\u505a\u7684\u4e8b\u60c5\u662f\u521d\u59cb\u5316\u65f6\u5019\u5b9e\u4f8b\u5316\u7c7b\u7ec4\u4ef6\uff0c\u66f4\u65b0\u7684\u8bdd\u90a3\u4e48\u76f4\u63a5\u8c03\u7528 render \u5f97\u5230\u65b0\u7684 ",l.createElement("code",null,"children")," \uff1b"),l.createElement("li",null,"\u66f4\u65b0\u51fd\u6570\u7ec4\u4ef6\u7528\u7684\u662f ",l.createElement("code",null,"updateFunctionComponent"),"\uff0c\u91cc\u9762\u8c03\u7528 ",l.createElement("code",null,"renderWithHooks")," \u6267\u884c\u51fd\u6570\u7ec4\u4ef6\u5e76\u4f9d\u6b21\u8c03\u7528 ",l.createElement("code",null,"hooks"),"\u3002\u8fd9\u91cc\u7ec6\u8282\u95ee\u9898\u4e0d\u9700\u8981\u62d8\u6ce5\u3002")),l.createElement("p",null,"\u90a3\u4e48\u5728\u6574\u4e2a ",l.createElement("code",null,"React")," \u7cfb\u7edf\u4e2d\uff0c\u80fd\u591f\u66f4\u65b0 state \u7684\u57fa\u672c\u90fd\u5728\u7ec4\u4ef6\u5c42\u9762\u4e0a\uff0c\u6362\u53e5\u8bdd\u8bf4\u53ea\u6709\u7ec4\u4ef6\u624d\u80fd\u51fa\u53d1\u66f4\u65b0\uff0c\u6bd4\u5982 ",l.createElement("code",null,"div")," \u5143\u7d20 hostComponent \u7c7b\u578b\u7684 fiber\uff0c\u5b83\u662f\u65e0\u6cd5\u72ec\u7acb\u7684\u81ea\u6211\u66f4\u65b0\u7684\uff0c\u53ea\u80fd\u4f9d\u8d56\u4e8e\u7236\u7c7b\u7684\u7ec4\u4ef6\u66f4\u65b0 state \uff0c\u4f46\u662f\u5728\u8c03\u548c\u9636\u6bb5\uff0c\u5b83\u4e5f\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u4efb\u52a1\u5355\u5143\u8fdb\u5165\u5230 workLoop \u4e2d \uff1b\u7efc\u4e0a\u6240\u8ff0\uff0c\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3"),l.createElement("ul",null,l.createElement("li",null,l.createElement("strong",null,"fiber\u662f\u8c03\u548c\u8fc7\u7a0b\u4e2d\u7684\u6700\u5c0f\u5355\u5143\uff0c\u6bcf\u4e00\u4e2a\u9700\u8981\u8c03\u548c\u7684 fiber \u90fd\u4f1a\u8fdb\u5165 workLoop \u4e2d\u3002")),l.createElement("li",null,l.createElement("strong",null,"\u800c\u7ec4\u4ef6\u662f\u6700\u5c0f\u7684\u66f4\u65b0\u5355\u5143\uff0cReact \u7684\u66f4\u65b0\u6e90\u4e8e\u6570\u636e\u5c42 state \u7684\u53d8\u5316\u3002"))),l.createElement("h3",{id:"2-beginwork-\u66f4\u65b0\u6e90\u6cc9"},l.createElement(r.AnchorLink,{to:"#2-beginwork-\u66f4\u65b0\u6e90\u6cc9","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"2 beginWork \u66f4\u65b0\u6e90\u6cc9"),l.createElement("p",null,"\u90a3\u4e48\u6211\u4eec\u4eca\u5929\u7684\u4e3b\u89d2\u5c31\u662f\u7ec4\u4ef6\u7c7b\u578b\u7684 fiber \u3002\u6df1\u5165\u7814\u7a76\u4e00\u4e0b\u7ec4\u4ef6\u7c7b\u578b\u7684 fiber \u8c03\u548c\u6d41\u7a0b\u3002\u7c7b\u7ec4\u4ef6\u5728 render \u9636\u6bb5\u7684\u4e00\u4e2a\u91cd\u8981\u4f5c\u7528\u5c31\u662f\u4ea7\u751f\u65b0\u7684 children \uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 ",l.createElement("code",null,"rerender"),"\u3002\u53ea\u6709\u4ea7\u751f\u65b0\u7684 children \uff0c\u63a5\u4e0b\u6765\u624d\u80fd\u6df1\u5ea6\u904d\u5386 children \uff0c\u6539\u53d8\u89c6\u56fe\u3002\u6bcf\u4e00\u4e2a\u9700\u8981\u8c03\u548c\u7684 fiber \u90fd\u8981\u7ecf\u5386\u4e00\u4e2a\u8fc7\u7a0b\u53eb\u505a ",l.createElement("strong",null,l.createElement("code",null,"beginWork"))," \uff0c\u5728 beginWork \u6d41\u7a0b\u4e2d\u5c06\u6267\u884c\u4e0a\u8ff0\u5404\u79cd fiber \u7684\u66f4\u65b0\u51fd\u6570\u3002"),l.createElement("p",null,"\u90a3\u4e48\u5bf9\u4e8e\u7ec4\u4ef6\u7c7b\u578b fiber \u8bf4\uff0c\u8fdb\u5165\u5230 workLoop \u4e2d\uff0c\u90a3\u4e48\u4e00\u5b9a\u4f1a ",l.createElement("code",null,"rerender")," \u5417\uff1f \u7b54\u6848\u662f\u5426\u5b9a\u7684\uff0c\u89e3\u6790\u6765\u770b\u51e0\u79cd\u60c5\u51b5\u3002"),l.createElement("p",null,"\u4e3b\u8981\u770b\u4e00\u4e0b\u5982\u4e0b demo \uff1a"),l.createElement(c.Z,{code:"/* \u5b50\u7ec4\u4ef62 */\nfunction Child2(){\n    return <div>\u5b50\u7ec4\u4ef6 2</div>\n}\n/* \u5b50\u7ec4\u4ef61 */\nfunction Child1(){\n    const [ num , setNumber ] = React.useState(0)\n    return <div>\n        \u5b50\u7ec4\u4ef6 {num}\n        <button onClick={() => setNumber(num+1)} >\u6309\u94ae1</button>\n     </div>\n}\n/* \u7236\u7ec4\u4ef6 */\nexport default function Index(){\n    const [ num , setNumber ] = React.useState(0)\n    return <div>\n        <p>\u7236\u7ec4\u4ef6 {num} </p>\n        <Child1 />\n        <Child2 />\n        <button onClick={()=> setNumber(num+1)} >\u6309\u94ae2</button>\n    </div>\n}",lang:"js"}),l.createElement("p",null,l.createElement("strong",null,"\u573a\u666f\u4e00"),"\uff1a\u5982\u4e0a demo \u4e2d\uff0c\u5f53\u70b9\u51fb ",l.createElement("code",null,"Child1")," \u7684 ",l.createElement("strong",null,"\u6309\u94ae1")," \u7684\u65f6\u5019\uff0cChild1 \u4f1a\u6e32\u67d3\uff0c\u90a3\u4e48 Child1 \u81ea\u7136\u4f1a\u8fdb\u5165\u5230 ",l.createElement("code",null,"beginWork")," \u6d41\u7a0b\u4e2d\uff0c\u90a3\u4e48\u7591\u95ee\u6765\u4e86\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u95ee\u9898\u4e00\uff1a\u7236\u7ec4\u4ef6 ",l.createElement("code",null,"Index")," \u6ca1\u6709\u66f4\u65b0\uff0c\u4f1a rerender \u5417\uff1f\u90a3\u4e48\u6709\u4f1a\u8fdb\u5165 ",l.createElement("code",null,"beginWork")," \u6d41\u7a0b\u5417 \uff1f"),l.createElement("li",null,"\u95ee\u9898\u4e8c\uff1a",l.createElement("code",null,"Child2")," \u4f1a\u8fdb\u5165 ",l.createElement("code",null,"beginWork"),"\u6d41\u7a0b\u5417 \uff1f"),l.createElement("li",null,"\u95ee\u9898\u4e09\uff1a\u5982\u679c ",l.createElement("code",null,"Index")," \u4f1a ",l.createElement("code",null,"beginWork"),"\uff0c\u90a3\u4e48 React \u4ece Root fiber \u5f00\u59cb\u8c03\u548c\u7684\u65f6\u5019\uff0c\u662f\u5982\u4f55\u627e\u5230\u66f4\u65b0\u7684\u4e8b\u53d1\u70b9 Index \u7684\u5462\uff1f")),l.createElement("p",null,l.createElement("strong",null,"\u573a\u666f\u4e8c"),"\uff1a\u5728\u5982\u4e0a demo \u4e2d\uff0c\u5f53\u70b9\u51fb Index \u4e2d\u7684 ",l.createElement("strong",null,"\u6309\u94ae2")," \u7684\u65f6\u5019\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u95ee\u9898\u56db\uff1a",l.createElement("code",null,"Index")," \u56e0\u4e3a\u672c\u8eab\u7684 ",l.createElement("code",null,"state")," \u6539\u53d8\u4f1a\u66f4\u65b0\uff0c\u90a3\u4e48 ",l.createElement("code",null,"Child1")," \u548c ",l.createElement("code",null,"Child2")," \u4e3a\u4ec0\u4e48\u4f1a\u8ddf\u7740\u66f4\u65b0\u3002")),l.createElement("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u5f00\u59cb\u4ee5\u4e00\u6b21\u66f4\u65b0\u5f00\u59cb\uff0c\u5206\u6790\u8c03\u548c\u8fc7\u7a0b\u4e2d beginWork \u6d41\u7a0b\u3002"),l.createElement("p",null,"\u5728\u6b63\u5f0f\u6d41\u7a0b\u5206\u6790\u4e4b\u524d\uff0c\u5148\u6765\u770b\u4e00\u4e0b v17 \u5f15\u51fa\u7684\u65b0\u7684\u6982\u5ff5\uff0c\u5728 v16 \u7248\u672c\uff0c\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u7528 expirationTime \u8868\u793a\uff0c\u5728 v17 \u7248\u672c\u88ab lane \u53d6\u7f14\u3002"),l.createElement("ul",null,l.createElement("li",null,l.createElement("strong",null,"lane")," \uff1a \u66f4\u65b0\u4f18\u5148\u7ea7\u3002\uff08\u5728\u4e00\u6b21\u66f4\u65b0\u4efb\u52a1\u4e2d\uff0c\u5c06\u8d4b\u4e88\u7ed9\u66f4\u65b0\u7684 fiber \u7684\u4e00\u4e2a\u66f4\u65b0\u4f18\u5148\u7ea7 lane\u3002\uff09"),l.createElement("li",null,l.createElement("strong",null,"childLanes"),"\uff1a",l.createElement("code",null,"children")," \u4e2d\u66f4\u65b0\u4f18\u5148\u7ea7\u3002\uff08\u5982\u679c\u5f53\u524d fiber \u7684 child \u4e2d\u6709\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\uff0c\u90a3\u4e48\u5f53\u524d fiber \u7684 childLanes \u7b49\u4e8e\u5f53\u524d\u4f18\u5148\u7ea7\uff09\u3002")),l.createElement("p",null,"\u8bb0\u4f4f\u8fd9\u4e24\u4e2a\u6982\u5ff5\u5bf9\u4e8e\u4e0b\u9762\u6d41\u7a0b\u5206\u6790\u5f88\u6709\u5e2e\u52a9\u3002\u63a5\u4e0b\u6765\u5e26\u7740\u4e0a\u9762\u7684\u56db\u4e2a\u95ee\u9898\uff0c\u5f00\u59cb\u5f80\u4e0b\u5206\u6790\u3002"),l.createElement("h2",{id:"\u4e09-\u8d77\u6e90-\u4ece-state-\u6539\u53d8\u5230-scheduleupdateonfiber"},l.createElement(r.AnchorLink,{to:"#\u4e09-\u8d77\u6e90-\u4ece-state-\u6539\u53d8\u5230-scheduleupdateonfiber","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e09 \u8d77\u6e90: \u4ece state \u6539\u53d8\u5230 scheduleUpdateOnFiber"),l.createElement("p",null,"\u4e0b\u9762\u4ee5\u524d\u9762\u7684\u70b9\u51fb\u6309\u94ae\u89e6\u53d1\u4e00\u6b21\u66f4\u65b0\u4e3a\u4f8b\u5b50\ud83c\udf30\uff0c\u6df1\u5165\u63a2\u8ba8\u4e00\u4e0b\u66f4\u65b0\u7684\u59cb\u672b\u6e90\u5934\u3002\u9996\u5148\u4e0a\u8ff0\u8bb2\u5230\u8fc7\u66f4\u65b0\u662f\u4ee5",l.createElement("strong",null,"\u7ec4\u4ef6"),"\u4e3a\u7c92\u5ea6\uff0c\u90a3\u4e48\u8c03\u7528 ",l.createElement("code",null,"useState")," \u6216\u8005\u662f ",l.createElement("code",null,"setState")," \u63a5\u4e0b\u6765\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1f"),l.createElement("p",null,l.createElement("strong",null,"\u7c7b\u7ec4\u4ef6 setState \u66f4\u65b0")),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberClassComponent.new.js -> classComponentUpdater")),l.createElement(c.Z,{code:"enqueueSetState(inst, payload, callback){\n     const fiber = getInstance(inst);       \n     const lane = requestUpdateLane(fiber);\n     scheduleUpdateOnFiber(fiber, lane, eventTime);\n}",lang:"js"}),l.createElement("p",null,l.createElement("strong",null,"\u51fd\u6570\u7ec4\u4ef6 useState \u66f4\u65b0")),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberHooks.new.js -> dispatchReducerAction")),l.createElement(c.Z,{code:"function dispatchReducerAction(fiber,queue,action){\n    const lane = requestUpdateLane(fiber);\n    scheduleUpdateOnFiber(fiber, lane, eventTime);\n}",lang:"js"}),l.createElement("p",null,"\u5982\u4e0a\u4ee3\u7801\u90fd\u662f\u7cbe\u7b80\u540e\uff0c\u4fdd\u7559\u7684\u6700\u6838\u5fc3\u7684\u6d41\u7a0b\u3002\u53ef\u4ee5\u660e\u786e\u770b\u5230\uff0c\u65e0\u8bba\u662f\u7ec4\u4ef6\u66f4\u65b0\u7684\u672c\u8d28\u5c31\u662f\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u521b\u5efa\u4e00\u4e2a\u4efb\u52a1\u4f18\u5148\u7ea7 lane\u3002"),l.createElement("li",null,"\u7136\u540e\u8fdb\u884c ",l.createElement("strong",null,"scheduleUpdateOnFiber"),"\u3002 \u90a3\u4e48\u8fd9\u4e2a scheduleUpdateOnFiber \u5e94\u8be5\u5c31\u662f\u6574\u4e2a React \u66f4\u65b0\u4efb\u52a1\u7684\u5f00\u59cb\u3002\u90a3\u4e48\u8fd9\u4e2a\u51fd\u6570\u5230\u5e95\u505a\u4e86\u4e9b\u4ec0\u4e48\u5462 \uff1f")),l.createElement("h3",{id:"1-scheduleupdateonfiber-\u5f00\u59cb\u66f4\u65b0-fiber"},l.createElement(r.AnchorLink,{to:"#1-scheduleupdateonfiber-\u5f00\u59cb\u66f4\u65b0-fiber","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"1 scheduleUpdateOnFiber \u5f00\u59cb\u66f4\u65b0 fiber"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.new.js -> scheduleUpdateOnFiber")),l.createElement(c.Z,{code:"function scheduleUpdateOnFiber(fiber,lane){\n    /* \u9012\u5f52\u5411\u4e0a\u6807\u8bb0\u66f4\u65b0\u4f18\u5148\u7ea7 */\n    const root = markUpdateLaneFromFiberToRoot(fiber, lane);\n    if(root === null) return null\n    /* \u5982\u679c\u5f53\u524d root \u786e\u5b9a\u66f4\u65b0\uff0c\u90a3\u4e48\u4f1a\u6267\u884c ensureRootIsScheduled */\n    ensureRootIsScheduled(root, eventTime);\n}",lang:"js"}),l.createElement("p",null,"scheduleUpdateOnFiber \u4e3b\u8981\u505a\u4e86\u4e24\u4ef6\u4e8b\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u7b2c\u4e00\u4e2a\u5c31\u662f\u901a\u8fc7\u5f53\u524d\u7684\u66f4\u65b0\u4f18\u5148\u7ea7 lane \uff0c\u628a\u5f53\u524d fiber \u5230 rootFiber \u7684\u7236\u7ea7\u94fe\u8868\u4e0a\u7684\u6240\u6709\u4f18\u5148\u7ea7\u90fd\u7ed9\u66f4\u65b0\u4e86\u3002"),l.createElement("li",null,"\u5982\u679c\u5f53\u524d fiber \u786e\u5b9a\u66f4\u65b0\uff0c\u90a3\u4e48\u4f1a\u8c03\u7528 ensureRootIsScheduled \uff0c")),l.createElement("p",null,l.createElement("strong",null,"\u90a3\u4e48 markUpdateLaneFromFiberToRoot \u5982\u4f55\u6807\u8bb0\u7684\u4f18\u5148\u7ea7\uff1f \u8fd9\u4e2a\u5f88\u91cd\u8981\uff01")),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.new.js -> markUpdateLaneFromFiberToRoot")),l.createElement(c.Z,{code:"/**\n * @param {*} sourceFiber \u53d1\u751f state \u53d8\u5316\u7684fiber \uff0c\u6bd4\u5982\u7ec4\u4ef6 A \u89e6\u53d1\u4e86 useState \uff0c\u90a3\u4e48\u7ec4\u4ef6 A \u5bf9\u5e94\u7684 fiber \u5c31\u662f sourceFiber\n * @param {*} lane        \u4ea7\u751f\u7684\u66f4\u65b0\u4f18\u5148\u7ea7\n */\nfunction markUpdateLaneFromFiberToRoot(sourceFiber,lane){\n    /* \u66f4\u65b0\u5f53\u524d fiber \u4e0a */\n    sourceFiber.lanes = mergeLanes(sourceFiber.lanes, lane);\n    /* \u66f4\u65b0\u7f13\u5b58\u6811\u4e0a\u7684 lanes */\n    let alternate = sourceFiber.alternate;\n    if (alternate !== null) alternate.lanes = mergeLanes(alternate.lanes, lane);\n    /* \u5f53\u524d\u66f4\u65b0\u7684 fiber */\n    let node = sourceFiber;\n    /* \u627e\u5230\u8fd4\u56de\u7236\u7ea7 */\n    let parent = sourceFiber.return;\n    while(parent !== null){\n        /* TODO: \u66f4\u65b0 childLanes \u5b57\u6bb5 */\n        parent.childLanes = mergeLanes(parent.childLanes, lane);\n        if (alternate !== null) {  alternate.childLanes = mergeLanes(alternate.childLanes, lane); }\n        /* \u9012\u5f52\u904d\u5386\u66f4\u65b0 */\n        node = parent;\n        parent = parent.return;\n    }\n}",lang:"js"}),l.createElement("p",null,"markUpdateLaneFromFiberToRoot \u505a\u7684\u4e8b\u5f88\u91cd\u8981\u3002"),l.createElement("ul",null,l.createElement("li",null,"\u9996\u5148\u4f1a\u66f4\u65b0\u5f53\u524d fiber \u4e0a\u7684\u66f4\u65b0\u4f18\u5148\u7ea7\u3002\u5728 fiber \u7ae0\u8282\u6211\u4eec\u8bb2\u8fc7\uff0cfiber \u67b6\u6784\u91c7\u7528 \u2018\u8fde\u4f53\u5a74\u2019\u5f62\u5f0f\u7684\u53cc\u7f13\u51b2\u6811\uff0c\u6240\u6709\u8fd8\u8981\u66f4\u65b0\u5f53\u524d fiber \u7684\u7f13\u51b2\u6811 ",l.createElement("code",null,"alternate")," \u4e0a\u7684\u4f18\u5148\u7ea7\u3002"),l.createElement("li",null,"\u7136\u540e\u4f1a\u9012\u5f52\u5411\u4e0a\u628a\u7236\u7ea7\u8fde\u4e0a\u7684 childLanes \u90fd\u66f4\u65b0\uff0c\u66f4\u65b0\u6210\u5f53\u524d\u7684\u4efb\u52a1\u4f18\u5148\u7ea7\u3002")),l.createElement("p",null,"\u91cd\u70b9\u60f3\u4e00\u60f3\u4e3a\u4ec0\u4e48\u5411\u4e0a\u9012\u5f52\u66f4\u65b0\u7236\u7ea7\u7684 childLanes \uff1f"),l.createElement("ul",null,l.createElement("li",null,"\u9996\u5148\u901a\u8fc7 fiber \u7ae0\u8282\u6211\u4eec\u77e5\u9053\uff0c\u6240\u6709\u7684 fiber \u662f\u901a\u8fc7\u4e00\u9897 fiber \u6811\u5173\u8054\u5230\u4e00\u8d77\u7684\uff0c\u5982\u679c\u7ec4\u4ef6 A \u53d1\u751f\u4e00\u6b21\u66f4\u65b0\uff0cReact \u662f\u4ece root \u5f00\u59cb\u6df1\u5ea6\u904d\u5386\u66f4\u65b0 fiber \u6811\u3002"),l.createElement("li",null,"\u90a3\u4e48\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u9700\u8981\u6df1\u5ea6\u904d\u5386\u6574\u4e2a fiber \u6811\u5417\uff1f\uff0c\u5f53\u7136\u4e5f\u4e0d\u662f\uff0c\u90a3\u4e48\u53ea\u6709\u4e00\u4e2a\u7ec4\u4ef6\u66f4\u65b0\uff0c\u6240\u6709\u7684 fiber \u8282\u70b9\u90fd\u8c03\u548c\u65e0\u7591\u662f\u6027\u80fd\u4e0a\u7684\u6d6a\u8d39\u3002"),l.createElement("li",null,"\u65e2\u7136\u8981\u4ece\u5934\u66f4\u65b0\uff0c\u53c8\u4e0d\u60f3\u8c03\u548c\u6574\u4e2a fiber \u6811\uff0c\u90a3\u4e48\u5982\u4f55\u627e\u5230\u66f4\u65b0\u7684\u7ec4\u4ef6 A \u5462\uff1f\u8fd9\u4e2a\u65f6\u5019 ",l.createElement("strong",null,l.createElement("code",null,"childLanes"))," \u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\uff0c\u5982\u679c A \u53d1\u751f\u4e86\u66f4\u65b0\uff0c\u90a3\u4e48\u5148\u5411\u4e0a\u9012\u5f52\u66f4\u65b0\u7236\u7ea7\u94fe\u7684 ",l.createElement("code",null,"childLanes"),"\uff0c\u63a5\u4e0b\u6765\u4ece Root Fiber \u5411\u4e0b\u8c03\u548c\u7684\u65f6\u5019\uff0c\u53d1\u73b0 childLanes \u7b49\u4e8e\u5f53\u524d\u66f4\u65b0\u4f18\u5148\u7ea7 ",l.createElement("code",null,"updateLanes"),"\uff0c\u90a3\u4e48\u8bf4\u660e\u5b83\u7684 child \u94fe\u4e0a\u6709\u65b0\u7684\u66f4\u65b0\u4efb\u52a1\uff0c\u5219\u4f1a\u7ee7\u7eed\u5411\u4e0b\u8c03\u548c\uff0c\u53cd\u4e4b\u9000\u51fa\u8c03\u548c\u6d41\u7a0b\u3002")),l.createElement("p",null,"\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u4e0a\u9762\u95ee\u98983 ",l.createElement("code",null,"\u5982\u679c "),"Index",l.createElement("code",null,"\u4f1a"),"beginWork",l.createElement("code",null,"\uff0c\u90a3\u4e48 React \u4ece Root fiber \u5f00\u59cb\u8c03\u548c\u7684\u65f6\u5019\uff0c\u662f\u5982\u4f55\u627e\u5230\u66f4\u65b0\u7684\u4e8b\u53d1\u70b9 Index \u7684\u5462\uff1f"),"\uff0c",l.createElement("strong",null,"Root Fiber \u662f\u901a\u8fc7 childLanes \u9010\u6e10\u5411\u4e0b\u8c03\u548c\u627e\u5230\u9700\u8981\u66f4\u65b0\u7684\u7ec4\u4ef6\u7684\u3002")),l.createElement("p",null,"\u4e3a\u4e86\u66f4\u6e05\u6670\u7684\u4e86\u89e3\u6d41\u7a0b\u8fd9\u91cc\u753b\u4e86\u4e00\u4e2a\u6d41\u7a0b\u56fe\u3002\u5982\u4e0b\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2421bbf350134d438f1bdc12b2882974~tplv-k3u1fbpfcp-watermark.awebp?",alt:"1.jpg"})," \u4e0a\u9762\u63cf\u8ff0\u4e86\u6574\u4e2a fiber \u6811\u8c03\u548c\u6d41\u7a0b\u3002"),l.createElement("ul",null,l.createElement("li",null,"\u7b2c\u4e00\u9636\u6bb5\u662f\u53d1\u751f\u66f4\u65b0\uff0c\u90a3\u4e48\u4ea7\u751f\u4e00\u4e2a\u66f4\u65b0\u4f18\u5148\u7ea7 ",l.createElement("code",null,"lane")," \u3002"),l.createElement("li",null,"\u7b2c\u4e8c\u9636\u6bb5\u5411\u4e0a\u6807\u8bb0 childLanes \u8fc7\u7a0b\u3002"),l.createElement("li",null,"\u7b2c\u4e09\u9636\u6bb5\u662f\u5411\u4e0b\u8c03\u548c\u8fc7\u7a0b\uff0c\u6709\u7684\u540c\u5b66\u4f1a\u95ee\uff0c\u4e3a\u4ec0\u4e48 A \u4f1a\u88ab\u8c03\u548c\uff0c\u539f\u56e0\u662f A \u548c B \u662f\u540c\u7ea7\uff0c\u5982\u679c\u7236\u7ea7\u5143\u7d20\u8c03\u548c\uff0c\u5e76\u4e14\u5411\u4e0b\u8c03\u548c\uff0c\u90a3\u4e48\u7236\u7ea7\u7684\u7b2c\u4e00\u7ea7\u5b50\u94fe\u4e0a\u7684 fiber \u90fd\u4f1a\u8fdb\u5165\u8c03\u548c\u6d41\u7a0b\u3002\u4ece fiber \u5173\u7cfb\u4e0a\u770b\uff0cRoot \u5148\u8c03\u548c\u7684\u662f child \u6307\u9488\u4e0a\u7684 A \uff0c\u7136\u540e A \u4f1a\u9000\u51fa\u5411\u4e0b\u8c03\u548c\uff0c\u63a5\u4e0b\u6765\u624d\u662f sibling B\uff0c\u63a5\u4e0b\u6765 B \u4f1a\u5411\u4e0b\u8c03\u548c\uff0c\u901a\u8fc7 childLanes \u627e\u5230\u5f53\u4e8b\u4eba F\uff0c\u7136\u540e F \u4f1a\u89e6\u53d1 render \u66f4\u65b0\u3002\u8fd9\u4e5f\u5c31\u89e3\u51b3\u95ee\u98982\uff0cChild2 \u7684\u8c03\u548c\u95ee\u9898\u3002")),l.createElement("p",null,"\u901a\u8fc7\u4e0a\u8ff0\u6211\u4eec\u77e5\u9053\u4e86\u5982\u4f55\u627e\u5230 F \u5e76\u6267\u884c render \u7684\uff0c\u90a3\u4e48\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f B\uff0cE \u4f1a\u5411\u4e0b\u8c03\u548c\uff0c\u5982\u679c\u5b83\u4eec\u662f\u7ec4\u4ef6\uff0c\u90a3\u4e48\u4f1a render \u4e48\uff0c\u7b54\u6848\u662f\u5426\u5b9a\u7684\uff0c\u8981\u8bb0\u4f4f\u7684\u662f",l.createElement("strong",null,"\u8c03\u548c\u8fc7\u7a0b\u5e76\u975e render \u8fc7\u7a0b"),"\uff0c\u8c03\u548c\u8fc7\u7a0b\u6709\u53ef\u80fd\u4f1a\u89e6\u53d1 render \u51fd\u6570\uff0c\u4e5f\u6709\u53ef\u80fd\u53ea\u662f\u7ee7\u7eed\u5411\u4e0b\u8c03\u548c\uff0c\u800c\u672c\u8eab\u4e0d\u4f1a\u6267\u884c render \u3002\u8fd9\u5c31\u89e3\u91ca\u4e86\u4e0a\u8ff0\u7684\u95ee\u98981\u3002"),l.createElement("p",null,"\u65e2\u7136\u77e5\u9053\u4e86\u5982\u4f55\u53bb\u66f4\u65b0 childLanes \uff0c\u4ee5\u53ca\u66f4\u65b0 childLanes \u7684\u610f\u4e49\uff0c\u6211\u4eec\u63a5\u7740\u5411\u4e0b\u5206\u6790\u6d41\u7a0b\u3002\u5728 scheduleUpdateOnFiber \u4e2d\uff0c\u6700\u540e\u4f1a\u8c03\u7528 ",l.createElement("code",null,"ensureRootIsScheduled")," \uff0c\u90a3\u4e48\u5b83\u7684\u4f5c\u7528\u53c8\u662f\u4ec0\u4e48\u5462\uff1f"),l.createElement("p",null,"\u7531\u4e8e ensureRootIsScheduled \u6e90\u7801\u6bd4\u8f83\u7e41\u7410\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5360\u7bc7\u5e45\u4e86\uff0c\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u6839\u636e\u4efb\u52a1\u7684\u7c7b\u578b\uff0c\u53d1\u8d77\u5f02\u6b65\u8c03\u5ea6\u4efb\u52a1\uff0c\u5728\u8c03\u5ea6\u7ae0\u8282\u5df2\u7ecf\u8bb2\u4e86\u8c03\u5ea6\u6d41\u7a0b\u3002\u63a5\u4e0b\u6765\u4f1a\u8d70\u8c03\u5ea6\u7684\u6d41\u7a0b\u3002"),l.createElement("ul",null,l.createElement("li",null,"\u5bf9\u4e8e ",l.createElement("code",null,"legacy sync")," \u6a21\u5f0f\u6700\u540e\u7684\u66f4\u65b0\u4efb\u52a1\u662f ",l.createElement("code",null,"performSyncWorkOnRoot")," \u3002"),l.createElement("li",null,"\u5bf9\u4e8e ",l.createElement("code",null,"Concurrent")," \u6a21\u5f0f\u6700\u540e\u7684\u66f4\u65b0\u4efb\u52a1\u662f ",l.createElement("code",null,"performConcurrentWorkOnRoot"),"\u3002")),l.createElement("p",null,"\u6211\u4eec\u4eca\u5929\u4e3b\u8981\u8bb2\u7684\u662f\u7ec4\u4ef6 beginWork \u66f4\u65b0\u6d41\u7a0b\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e3b\u8981\u4ee5 legacy \u6a21\u5f0f\u4e3a\u4e3b\uff0c\u6240\u4ee5\u8ddf\u7740 performSyncWorkOnRoot \u6d41\u7a0b\u5f80\u4e0b\u770b\uff1a"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.new.js -> performSyncWorkOnRoot")),l.createElement(c.Z,{code:"function performSyncWorkOnRoot(root) {\n    /* render \u9636\u6bb5 */\n    let exitStatus = renderRootSync(root, lanes);\n    /* commit \u9636\u6bb5 */\n    commitRoot(root);\n    /* \u5982\u679c\u6709\u5176\u4ed6\u7684\u7b49\u5f85\u4e2d\u7684\u4efb\u52a1\uff0c\u90a3\u4e48\u7ee7\u7eed\u66f4\u65b0 */\n    ensureRootIsScheduled(root, now());\n}",lang:"js"}),l.createElement("p",null,"\u4e4b\u524d\u7684\u7ae0\u8282\u4e2d\u4ecb\u7ecd\u4e86\u8c03\u548c\u7684\u4e24\u5927\u9636\u6bb5 ",l.createElement("code",null,"render")," \u548c ",l.createElement("code",null,"commit")," \u90fd\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u6267\u884c\u3002"),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"renderRootSync")," \u4ee3\u8868 render \u9636\u6bb5\u3002"),l.createElement("li",null,l.createElement("code",null,"commitRoot")," \u4ee3\u8868 commit \u9636\u6bb5\u3002"),l.createElement("li",null,"\u5f53 render \u548c commit \u9636\u6bb5\u6267\u884c\u4e4b\u540e\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7684\u7b49\u5f85\u4e2d\u7684\u4efb\u52a1\uff0c\u90a3\u4e48\u7ee7\u7eed\u6267\u884c\u8c03\u5ea6\u4efb\u52a1\u3002")),l.createElement("p",null,"\u5230\u6b64\u4e3a\u6b62\uff0c\u4e00\u6b21\u66f4\u65b0\u8c03\u5ea6\u4efb\u52a1\u7684\u521d\u59cb\u5316\u5de5\u4f5c\u5b8c\u6210\u3002\u5f00\u59cb\u6b63\u5f0f\u8fdb\u5165\u8c03\u548c\u9636\u6bb5\u3002\u6211\u5bf9\u524d\u620f\u9636\u6bb5\u505a\u4e00\u4e0b\u603b\u7ed3\uff0c\u6d41\u7a0b\u56fe\u5982\u4e0b\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8710f7ad77f44ecb97cd6200c4a5b76~tplv-k3u1fbpfcp-watermark.awebp?",alt:"2.jpg"})),l.createElement("h2",{id:"\u56db-\u63a2\u7d22\u4ece-workloop-\u5230-beginwork"},l.createElement(r.AnchorLink,{to:"#\u56db-\u63a2\u7d22\u4ece-workloop-\u5230-beginwork","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u56db \u63a2\u7d22\uff1a\u4ece workLoop \u5230 beginWork"),l.createElement("p",null,"\u4e0a\u8ff0\u8bb2\u5230\u4e86 performSyncWorkOnRoot \u6b63\u5f0f\u8fdb\u5165\u4e86 fiber \u7684\u8c03\u548c\u6d41\u7a0b\u3002\u56e0\u4e3a\u672c\u7ae0\u8282\u4e3b\u8981\u8bb2 beginWork \u548c\u7ec4\u4ef6\u66f4\u65b0\u6d41\u7a0b\uff0c\u8fd9\u4e9b\u4e3b\u8981\u90fd\u53d1\u751f\u5728 ",l.createElement("code",null,"render")," \u9636\u6bb5\uff0c\u6240\u4ee5\u4e0b\u9762\u5c06\u56f4\u7ed5 ",l.createElement("code",null,"renderRootSync")," \u5c55\u5f00\u3002\u9996\u5148\u770b\u4e00\u4e0b renderRootSync \u505a\u4e86\u4ec0\u4e48\uff1f"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.new.js -> renderRootSync")),l.createElement(c.Z,{code:"function renderRootSync(root,lanes){\n    workLoopSync();\n    /* workLoop\u5b8c\u6bd5\u540e\uff0c\u8bc1\u660e\u6240\u6709\u8282\u70b9\u90fd\u904d\u5386\u5b8c\u6bd5\uff0c\u90a3\u4e48\u91cd\u7f6e\u72b6\u6001\uff0c\u8fdb\u5165 commit \u9636\u6bb5 */\n    workInProgressRoot = null;\n    workInProgressRootRenderLanes = NoLanes;\n}",lang:"js"}),l.createElement("p",null,"renderRootSync \u6838\u5fc3\u529f\u80fd\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u6267\u884c ",l.createElement("code",null,"workLoopSync"),"\u3002"),l.createElement("li",null,l.createElement("code",null,"workLoop")," \u5b8c\u6bd5\u540e\uff0c\u8bc1\u660e\u6240\u6709\u8282\u70b9\u90fd\u904d\u5386\u5b8c\u6bd5\uff0c\u90a3\u4e48\u91cd\u7f6e\u72b6\u6001\uff0c\u8fdb\u5165 ",l.createElement("code",null,"commit")," \u9636\u6bb5\u3002")),l.createElement("p",null,l.createElement("code",null,"workLoopSync")," \u5728\u6574\u4e2a render \u6d41\u7a0b\u4e2d\u5145\u5f53\u7684\u89d2\u8272\u975e\u5e38\u91cd\u8981\uff0c\u53ef\u4ee5\u628a ",l.createElement("code",null,"workLoopSync")," \u5f53\u4f5c\u4e00\u4e2a\u5faa\u73af\u8fd0\u4f5c\u7684\u52a0\u5de5\u5668\uff0c\u6bcf\u4e00\u4e2a\u9700\u8981\u8c03\u548c\u7684 fiber \u53ef\u4ee5\u5f53\u4f5c\u4e00\u4e2a\u96f6\u4ef6\uff0c\u6bcf\u4e00\u4e2a\u96f6\u4ef6\u90fd\u9700\u8981\u8fdb\u5165\u52a0\u5de5\u5668\uff0c\u5982\u679c\u6ca1\u6709\u5f85\u52a0\u5de5\u7684\u96f6\u4ef6\uff0c\u90a3\u4e48\u52a0\u5de5\u5668\u624d\u505c\u6b62\u8fd0\u8f6c\u3002\u4e0b\u9762\u5c31\u662f\u52a0\u5de5\u5668\u7684\u5177\u4f53\u5b9e\u73b0\u3002"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.new.js -> workLoopSync")),l.createElement(c.Z,{code:"function workLoopSync() {\n  /* \u5faa\u73af\u6267\u884c performUnitOfWork \uff0c\u4e00\u76f4\u5230 workInProgress \u4e3a\u7a7a */\n  while (workInProgress !== null) {\n    performUnitOfWork(workInProgress);\n  }\n}",lang:"js"}),l.createElement("ul",null,l.createElement("li",null,"\u5982\u4e0a\u53ea\u8981 ",l.createElement("code",null,"workInProgress")," \u4e0d\u4e3a ",l.createElement("code",null,"null"),"\uff08\u8fd8\u6709\u9700\u8981\u8c03\u548c\u7684 fiber\uff09\uff0c\u90a3\u4e48 workLoopSync \u4f1a\u5faa\u73af\u8c03\u7528 performUnitOfWork\u3002")),l.createElement("p",null,"\u5728\u8c03\u5ea6\u7ae0\u8282\u8bb2\u5230\u8fc7\uff0c\u5f53 Concurrent \u6a21\u5f0f\u4e0b\u4f1a\u901a\u8fc7 ",l.createElement("code",null,"shouldYield")," \uff0c\u6765\u5224\u65ad\u6709\u6ca1\u6709\u8fc7\u671f\u7684\u4efb\u52a1\uff0c\u6709\u8fc7\u671f\u4efb\u52a1\uff0c\u4f1a\u4e2d\u65ad workLoop \uff0c\u90a3\u4e48\u4e5f\u5c31\u662f\u8bf4\u660e\u4e86",l.createElement("strong",null,"render\u9636\u6bb5\u662f\u53ef\u4ee5\u88ab\u6253\u65ad\u7684\u3002")),l.createElement(c.Z,{code:"while (workInProgress !== null && !shouldYield()) {\n  performUnitOfWork(workInProgress);\n}",lang:"js"}),l.createElement("p",null,"\u56de\u5230 workLoopSync \u6d41\u7a0b\u4e0a\u6765\uff0c\u901a\u8fc7 fiber \u7ae0\u8282\uff0c\u8bb2\u5230 fiber \u6811\u662f\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u5f97\u5230\u7684\uff0c\u5728\u904d\u5386\u5b8c\u7236\u8282\u70b9\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u4f1a\u904d\u5386\u5b50\u8282\u70b9\u3002\u5728\u8fd9\u5176\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u8c03\u548c\u7684 fiber \u90fd\u5c06\u4f5c\u4e3a ",l.createElement("code",null,"workInProgress")," \u8fdb\u884c\u8c03\u548c\u66f4\u65b0\u3002"),l.createElement("p",null,"\u65e0\u8bba\u4ec0\u4e48\u6a21\u5f0f\uff0cworkLoop \u7684\u6267\u884c\u5355\u5143\u90fd\u662f fiber \u3002\u800c\u4e14\u66f4\u65b0\u5355\u5143\u7684\u51fd\u6570\u53eb\u505a performUnitOfWork \u3002"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.new.js -> performUnitOfWork")),l.createElement(c.Z,{code:"function performUnitOfWork(unitOfWork){\n    const current = unitOfWork.alternate;\n    let  next = beginWork(current, unitOfWork, subtreeRenderLanes);\n    unitOfWork.memoizedProps = unitOfWork.pendingProps;\n    if (next === null) {\n       completeUnitOfWork(unitOfWork);\n    } else {\n      workInProgress = next;\n    }\n}",lang:"js"}),l.createElement("p",null,"\u5728 fiber \u7ae0\u8282\u8bb2\u5230\u8fc7, beginWork \u662f\u5411\u4e0b\u8c03\u548c\u6d41\u7a0b\uff0ccompleteUnitOfWork \u662f\u5411\u4e0a\u5f52\u5e76\u7684\u6d41\u7a0b\u3002\u90a3\u4e48\u4ee5\u7ec4\u4ef6\u66f4\u65b0\u6d41\u7a0b\u4e3a\u76ee\u7684\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u91cd\u70b9\u7814\u7a76 beginWork \u6d41\u7a0b\u3002"),l.createElement("p",null,"\u5728\u4ecb\u7ecd beginWork \u4e4b\u524d\u5148\u6765\u770b\u51e0\u4e2a\u573a\u666f\uff1a"),l.createElement("p",null,"\u5047\u8bbe\u6709\u4e00\u4e2a\u7ec4\u4ef6 fiber \u94fe\u3002\u6211\u4eec\u5728\u8fd9\u4e2a fiber \u94fe\u4e0a\u6682\u4e14\u65e0\u89c6\u5176\u4ed6\u7c7b\u578b\u7684 fiber\uff0c\u53ea\u4fdd\u7559\u7ec4\u4ef6\u7c7b\u578b\u7684 fiber\u3002\u7ed3\u6784\u5982\u4e0b\uff1a"),l.createElement("p",null,"root Fiber --child--\x3e A\u7ec4\u4ef6 --child--\x3e B\u7ec4\u4ef6 --child--\x3e C\u7ec4\u4ef6\u3002"),l.createElement("p",null,l.createElement("img",{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46a8441e883f4d70a39e5e56b58d6ff9~tplv-k3u1fbpfcp-watermark.awebp?",alt:"4.jpg"})),l.createElement("p",null,"\u800c\u4e3b\u89d2\u5c31\u662f",l.createElement("strong",null,"\u7ec4\u4ef6B"),"\uff0c\u4ee5\u7ec4\u4ef6B \u4e3a\u53c2\u8003\u3002\u6765\u770b\u4e00\u4e0b React \u5982\u4f55\u8c03\u548c\u7684\u3002\u90a3\u4e48\u4e00\u6b21\u66f4\u65b0\u5c31\u6709\u53ef\u80fd\u6709\u4e09\u79cd\u573a\u666f\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u573a\u666f\u4e00\uff1a",l.createElement("strong",null,"\u66f4\u65b0 A \u7ec4\u4ef6 state"),"\uff0c\u90a3\u4e48 A \u89e6\u53d1\u66f4\u65b0\uff0c\u90a3\u4e48\u5982\u679c B,C \u6ca1\u6709\u505a\u6e32\u67d3\u63a7\u5236\u5904\u7406\uff08\u6bd4\u5982 memo PureComponent\uff09\uff0c\u90a3\u4e48\u66f4\u65b0\u4f1a\u6ce2\u52a8\u5230 B \uff0c C\uff0c\u90a3\u4e48 A\uff0cB\uff0cC \u90fd\u4f1a rerender\u3002")),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37a14aa23434495aba1b9dfb985ff219~tplv-k3u1fbpfcp-watermark.awebp?",alt:"5.jpg"})),l.createElement("ul",null,l.createElement("li",null,"\u573a\u666f\u4e8c\uff1a",l.createElement("strong",null,"\u5f53\u66f4\u65b0 B \u7ec4\u4ef6"),"\uff0c\u90a3\u4e48\u7ec4\u4ef6 A fiber \u4f1a\u88ab\u6807\u8bb0\uff0c\u7136\u540e A \u4f1a\u8c03\u548c\uff0c\u4f46\u662f\u4e0d\u4f1a rerender\uff1b\u7ec4\u4ef6 B \u662f\u5f53\u4e8b\u4eba\uff0c\u65e2\u4f1a\u8fdb\u5165\u8c03\u548c\uff0c\u4e5f\u4f1a rerender\uff1b\u7ec4\u4ef6 C \u53d7\u5230\u7236\u7ec4\u4ef6 B \u7684\u5f71\u54cd\uff0c\u4f1a rerender\u3002")),l.createElement("p",null,l.createElement("img",{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e21e929037b04614897e20338752f324~tplv-k3u1fbpfcp-watermark.awebp?",alt:"6.jpg"})),l.createElement("ul",null,l.createElement("li",null,"\u573a\u666f\u4e09\uff1b",l.createElement("strong",null,"\u5f53\u66f4\u65b0 C\u7ec4\u4ef6"),"\uff0c\u90a3\u4e48 A\uff0cB \u4f1a\u8fdb\u5165\u8c03\u548c\u6d41\u7a0b\uff0c\u4f46\u662f\u4e0d\u4f1a rerender\uff0cC \u662f\u5f53\u4e8b\u4eba\uff0c\u4f1a\u8c03\u548c\u5e76 rerender\u3002")),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3691b87d164a427b8c7a180e53b6d84d~tplv-k3u1fbpfcp-watermark.awebp?",alt:"7.jpg"})),l.createElement("p",null,"\u90a3\u4e48\u5982\u4e0a\u7684\u573a\u666f\u672c\u8d28\u4e0a\u90fd\u5728 ",l.createElement("strong",null,l.createElement("code",null,"beginWork"))," \u4e2d\u8fdb\u884c\u7684\uff0c\u8fd9\u4e2a beginWork \u662f\u5982\u4f55\u5904\u7406\u8fd9\u4e9b\u903b\u8f91\u7684\u3002"),l.createElement("h2",{id:"\u4e94-\u63ed\u79d8\u4ece-beginwork-\u5230\u7ec4\u4ef6\u66f4\u65b0\u5168\u6d41\u7a0b"},l.createElement(r.AnchorLink,{to:"#\u4e94-\u63ed\u79d8\u4ece-beginwork-\u5230\u7ec4\u4ef6\u66f4\u65b0\u5168\u6d41\u7a0b","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e94 \u63ed\u79d8\uff1a\u4ece beginWork \u5230\u7ec4\u4ef6\u66f4\u65b0\u5168\u6d41\u7a0b"),l.createElement("p",null,"\u63a5\u4e0b\u6765\u4ece beginWork \u5f00\u59cb\uff0c\u91cd\u70b9\u7814\u7a76\u4e00\u4e0b\u6d41\u7a0b\u3002"),l.createElement("h3",{id:"1-beginwork-\u66f4\u65b0\u7684\u8c03\u5ea6\u7ad9"},l.createElement(r.AnchorLink,{to:"#1-beginwork-\u66f4\u65b0\u7684\u8c03\u5ea6\u7ad9","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"1 beginWork \u66f4\u65b0\u7684\u8c03\u5ea6\u7ad9"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberBeginWork.new.js -> beginWork")),l.createElement(c.Z,{code:"/**\n * @param {*} current         current \u6811 fiber \n * @param {*} workInProgress  workInProgress \u6811 fiber \n * @param {*} renderLanes     \u5f53\u524d\u7684 render \u4f18\u5148\u7ea7\n * @returns \n */\nfunction beginWork(current,workInProgress,renderLanes){\n    /* -------------------\u7b2c\u4e00\u90e8\u5206-------------------- */\n    if(current !== null){ \n        /* \u66f4\u65b0\u6d41\u7a0b */\n        /* current \u6811\u4e0a\u4e0a\u4e00\u6b21\u6e32\u67d3\u540e\u7684 props */\n        const oldProps = current.memoizedProps;\n        /* workInProgress \u6811\u4e0a\u8fd9\u4e00\u6b21\u66f4\u65b0\u7684 props  */\n        const newProps = workInProgress.pendingProps;\n        \n        if(oldProps !== newProps ||  hasLegacyContextChanged()){\n          didReceiveUpdate = true;\n        }else{\n          /* props \u548c context \u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u68c0\u67e5\u662f\u5426\u66f4\u65b0\u6765\u81ea\u81ea\u8eab\u6216\u8005 context \u6539\u53d8 */\n          const hasScheduledUpdateOrContext = checkScheduledUpdateOrContext(current,renderLanes)\n          if(!hasScheduledUpdateOrContext){\n              didReceiveUpdate = false;\n              return  attemptEarlyBailoutIfNoScheduledUpdate(current,workInProgress,renderLanes)\n          }\n          /* \u8fd9\u91cc\u7701\u7565\u4e86\u4e00\u4e9b\u5224\u65ad\u903b\u8f91 */\n          didReceiveUpdate = false;\n        }\n\n    }else{\n      didReceiveUpdate = false\n    }\n    /* -------------------\u7b2c\u4e8c\u90e8\u5206-------------------- */\n    /* TODO: \u8d70\u5230\u8fd9\u91cc\u6d41\u7a0b\u4f1a\u88ab\u8c03\u548c | \u66f4\u65b0\uff0c\u6bd4\u5982\u51fd\u6570\u6267\u884c\u4f1a\u6267\u884c\uff0c\u7c7b\u7ec4\u4ef6\u4f1a\u6267\u884c render \u3002 */\n    switch(workInProgress.tag){\n        /* \u51fd\u6570\u7ec4\u4ef6\u7684\u60c5\u51b5 */\n        case FunctionComponent: {\n           return updateFunctionComponent( current, workInProgress, Component, resolvedProps, renderLanes )\n        }\n        /* \u7c7b\u7ec4\u4ef6\u7684\u60c5\u51b5 */\n        case ClassComponent:{\n          return updateClassComponent(current,workInProgress,Component,resolvedProps,renderLanes)\n        }\n        /* \u5143\u7d20\u7c7b\u578b fiber <div>, <span>  */\n        case HostComponent:{\n          return updateHostComponent(current, workInProgress, renderLanes)\n        }\n        /* \u5176\u4ed6 fiber \u60c5\u51b5 */ \n    }\n}",lang:"js"}),l.createElement("p",null,"\u5982\u4e0a\u5c31\u662f ",l.createElement("code",null,"beginWork")," \u7684\u5168\u6d41\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6574\u4e2a\u6d41\u7a0b\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\u3002"),l.createElement("h3",{id:"2-\u7b2c\u4e00\u9636\u6bb5"},l.createElement(r.AnchorLink,{to:"#2-\u7b2c\u4e00\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"2 \u7b2c\u4e00\u9636\u6bb5"),l.createElement("p",null,"\u7b2c\u4e00\u90e8\u5206\uff0c\u8fd9\u90e8\u5206\u975e\u5e38\u91cd\u8981\u5c31\u662f\u5224\u65ad\u66f4\u65b0\u60c5\u51b5\u7684\uff0c\u4e0a\u9762\u7684\u4e09\u79cd\u573a\u666f\u90fd\u53ef\u4ee5\u5728\u7b2c\u4e00\u9636\u6bb5\u8fdb\u884c\u5224\u65ad\u5904\u7406\u3002\u5148\u6765\u5206\u6790\u4e00\u4e0b\u7b2c\u4e00\u9636\u6bb5\u505a\u4e86\u54ea\u4e9b\u4e8b\u3002\u6b63\u5f0f\u8bb2\u89e3\u4e4b\u524d\u5148\u6765\u770b\u4e00\u4e2a\u53d8\u91cf\u7684\u610f\u4e49\uff0c\u90a3\u5c31\u662f ",l.createElement("code",null,"didReceiveUpdate")," \u3002"),l.createElement("ul",null,l.createElement("li",null,"didReceiveUpdate \uff1a\u8fd9\u4e2a\u53d8\u91cf\u4e3b\u8981\u8bc1\u660e\u5f53\u524d\u66f4\u65b0\u662f\u5426\u6765\u6e90\u4e8e\u7236\u7ea7\u7684\u66f4\u65b0\uff0c\u90a3\u4e48\u81ea\u8eab\u5e76\u6ca1\u6709\u66f4\u65b0\u3002\u6bd4\u5982\u66f4\u65b0 B \u7ec4\u4ef6\uff0c\u90a3\u4e48 C\u7ec4\u4ef6\u4e5f\u4f1a\u8ddf\u7740\u66f4\u65b0\uff0c\u8fd9\u4e2a\u60c5\u51b5\u4e0b ",l.createElement("code",null,"didReceiveUpdate = true"),"\u3002"),l.createElement("li",null,"\u9996\u5148\u901a\u8fc7 ",l.createElement("code",null,"current!== null")," \u6765\u5224\u65ad\u5f53\u524d fiber \u662f\u5426\u521b\u5efa\u8fc7\uff0c\u5982\u679c\u7b2c\u4e00\u6b21 mounted \uff0c \u90a3\u4e48 current \u4e3a null\uff0c\u800c\u7b2c\u4e00\u9636\u6bb5\u4e3b\u8981\u9488\u5bf9\u66f4\u65b0\u7684\u60c5\u51b5\u3002\u5982\u679c\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u76f4\u63a5\u8df3\u8fc7\u7b2c\u4e00\u9636\u6bb5\uff0c",l.createElement("strong",null,"\u5230\u7b2c\u4e8c\u9636\u6bb5\u3002")),l.createElement("li",null,"\u5982\u679c\u662f\u66f4\u65b0\u6d41\u7a0b\u3002\u90a3\u4e48\u5224\u65ad oldProps === newProps\uff08\u6e90\u7801\u4e2d\u8fd8\u5224\u65ad\u4e86\u8001\u7248\u672c context \u662f\u5426\u53d8\u5316\uff09\uff0c\u90a3\u4e48\u4e24\u8005\u76f8\u7b49\u3002\u4e00\u822c\u4f1a\u6709\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a")),l.createElement("p",null,l.createElement("strong",null,"\u60c5\u51b5\u4e00"),"\uff1a\u8fd8\u662f\u56de\u5230\u4e0a\u9762\u573a\u666f\u4e0a\u6765\uff0c\u5982\u679c C \u7ec4\u4ef6\u66f4\u65b0\uff0c\u90a3\u4e48 B \u7ec4\u4ef6\u88ab\u6807\u8bb0 ChildLanes \u4f1a\u8fdb\u5165\u5230 beginWork \u8c03\u548c\u9636\u6bb5\uff0c\u4f46\u662f B \u7ec4\u4ef6\u672c\u8eab props \u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\u3002"),l.createElement("p",null,l.createElement("strong",null,"\u60c5\u51b5\u4e8c"),"\uff1a\u901a\u8fc7 useMemo \u7b49\u65b9\u5f0f\u7f13\u5b58\u4e86 React element \u5143\u7d20\uff0c\u5728\u6e32\u67d3\u63a7\u5236\u7ae0\u8282\u8bb2\u5230\u8fc7\u3002"),l.createElement("p",null,l.createElement("strong",null,"\u60c5\u51b5\u4e09"),"\uff1a\u5c31\u662f\u66f4\u65b0\u53d1\u751f\u5728\u5f53\u524d\u7ec4\u4ef6\u672c\u8eab\uff0c\u6bd4\u5982 B \u7ec4\u4ef6\u53d1\u751f\u66f4\u65b0\uff0c\u4f46\u662f B \u7ec4\u4ef6\u7684 props \u5e76\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u6240\u4ee5\u4e5f\u4f1a\u8d70\u5230\u8fd9\u4e2a\u6d41\u7a0b\u4e0a\u6765\u3002"),l.createElement("p",null,"\u53cd\u4e4b\u5982\u679c\u4e24\u8005\u4e0d\u60f3\u7b49\uff0c\u8bc1\u660e\u7236\u7ea7 fiber \u91cd\u65b0 rerender \u5bfc\u81f4\u4e86 props \u6539\u53d8\uff0c\u6b64\u65f6 didReceiveUpdate = true \uff0c\u90a3\u4e48\u7b2c\u4e00\u9636\u6bb5\u5b8c\u6210\uff0c",l.createElement("strong",null,"\u8fdb\u5165\u5230\u7b2c\u4e8c\u9636\u6bb5\u3002")),l.createElement("p",null,"\u521a\u624d\u8bb2\u5230\u5982\u679c",l.createElement("strong",null,"\u65b0\u8001 props \u76f8\u7b49"),"\uff0c\u4f1a\u6709\u4e00\u4e9b\u5904\u7406\u903b\u8f91\u3002\u90a3\u4e48\u5982\u679c\u5904\u7406\u7684\u5462\uff1f\u7b2c\u4e00\u4e2a\u5c31\u662f\u8c03\u7528 ",l.createElement("code",null,"checkScheduledUpdateOrContext")),l.createElement("p",null,l.createElement("strong",null,"checkScheduledUpdateOrContext")),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberBeginWork.new.js -> checkScheduledUpdateOrContext")),l.createElement(c.Z,{code:"function checkScheduledUpdateOrContext(current,renderLanes){\n    const updateLanes = current.lanes;\n    /* \u8fd9\u79cd\u60c5\u51b5\u8bf4\u660e\u5f53\u524d\u66f4\u65b0 */\n    if (includesSomeLane(updateLanes, renderLanes)) {\n      return true;\n    }\n     /* \u5982\u679c\u8be5 fiber \u6d88\u8d39\u4e86 context \uff0c\u5e76\u4e14 context \u53d1\u751f\u4e86\u6539\u53d8\u3002 */\n    if (enableLazyContextPropagation) {\n      const dependencies = current.dependencies;\n      if (dependencies !== null && checkIfContextChanged(dependencies)) {\n        return true;\n      }\n    }\n  return false;\n}",lang:"js"}),l.createElement("ul",null,l.createElement("li",null,"\u5f53\u65b0\u8001 props \u76f8\u7b49\u60c5\u51b5\uff0c\u9996\u5148\u4f1a\u68c0\u67e5\u5f53\u524d fiber \u7684 ",l.createElement("code",null,"lane")," \u662f\u5426\u7b49\u4e8e ",l.createElement("code",null,"updateLanes"),"\uff0c\u5982\u679c\u76f8\u7b49\uff0c\u90a3\u4e48\u8bc1\u660e\u66f4\u65b0\u6765\u6e90\u5f53\u524d fiber\uff0c\u6bd4\u5982 B \u7ec4\u4ef6\u53d1\u751f\u66f4\u65b0\uff0c\u90a3\u4e48\u4f1a\u8d70\u8fd9\u91cc\uff08\u60c5\u51b5\u4e09\uff09\u3002\u5f53\u7136\u671f\u95f4\u4e5f\u4f1a\u5224\u65ad\u662f\u5426\u6709\u6d88\u8d39 ",l.createElement("code",null,"context")," \u5e76\u53d1\u751f\u4e86\u53d8\u5316\u3002\u6700\u540e\u8fd4\u56de\u72b6\u6001 hasScheduledUpdateOrContext \u3002")),l.createElement("p",null,"\u5982\u679c ",l.createElement("code",null,"hasScheduledUpdateOrContext")," \u4e3a false\uff0c\u8bc1\u660e\u5f53\u524d\u7ec4\u4ef6\u6ca1\u6709\u66f4\u65b0\uff0c\u4e5f\u6ca1\u6709 context \u4e0a\u7684\u53d8\u5316\uff0c\u90a3\u4e48\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u5c31\u662f child \u53ef\u80fd\u6709\u66f4\u65b0\uff0c\u4f46\u662f\u5f53\u524d fiber \u4e0d\u9700\u8981\u66f4\u65b0\uff08\u60c5\u51b5\u4e00\uff09\u3002\u90a3\u4e48\u4f1a\u76f4\u63a5\u8fd4\u56de ",l.createElement("code",null,"attemptEarlyBailoutIfNoScheduledUpdate")," \uff0c",l.createElement("strong",null,"\u9000\u51fa\u7b2c\u4e8c\u9636\u6bb5"),"\u3002"),l.createElement("p",null,"attemptEarlyBailoutIfNoScheduledUpdate \u8fd9\u4e2a\u51fd\u6570\u4f1a\u5904\u7406\u90e8\u5206 Context \u903b\u8f91\uff0c\u4f46\u662f\u6700\u91cd\u8981\u7684\u662f\u8c03\u7528\u4e86 ",l.createElement("strong",null,l.createElement("code",null,"bailoutOnAlreadyFinishedWork"))," \u3002"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberBeginWork.new.js -> bailoutOnAlreadyFinishedWork")),l.createElement(c.Z,{code:"function bailoutOnAlreadyFinishedWork(current,workInProgress,renderLanes){\n     /* \u5982\u679c children \u6ca1\u6709\u9ad8\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\uff0c\u8bf4\u660e\u6240\u6709\u7684 child \u90fd\u6ca1\u6709\u66f4\u65b0\uff0c\u90a3\u4e48\u76f4\u63a5 \u8fd4\u56de\uff0cchild \u4e5f\u4e0d\u4f1a\u88ab\u8c03\u548c  */\n    if (!includesSomeLane(renderLanes, workInProgress.childLanes)) {\n      /* \u8fd9\u91cc\u505a\u4e86\u6d41\u7a0b\u7b80\u5316 */\n      return null \n    }\n    /* \u5f53\u524dfiber\u6ca1\u6709\u66f4\u65b0\u3002\u4f46\u662f\u5b83\u7684children \u9700\u8981\u66f4\u65b0\u3002  */\n    cloneChildFibers(current, workInProgress);\n    return workInProgress.child;\n}",lang:"js"}),l.createElement("p",null,"bailoutOnAlreadyFinishedWork \u6d41\u7a0b\u975e\u5e38\u91cd\u8981\u3002\u5b83\u4e3b\u8981\u505a\u4e86\u4e24\u4ef6\u4e8b\u3002"),l.createElement("ul",null,l.createElement("li",null,"\u9996\u5148\u901a\u8fc7 includesSomeLane \u5224\u65ad childLanes \u662f\u5426\u662f\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u90a3\u4e48\u6240\u6709\u5b50\u5b59 fiber \u90fd\u4e0d\u9700\u8981\u8c03\u548c \uff0c\u90a3\u4e48\u76f4\u63a5\u8fd4\u56de null\uff0cchild \u4e5f\u4e0d\u4f1a\u88ab\u8c03\u548c\u3002"),l.createElement("li",null,"\u5982\u679c childLanes \u4f18\u5148\u7ea7\u9ad8\uff0c\u90a3\u4e48\u8bc1\u660e child \u9700\u8981\u88ab\u8c03\u548c\uff0c\u4f46\u662f\u5f53\u524d\u7ec4\u4ef6\u4e0d\u9700\u8981\uff0c\u6240\u4ee5\u4f1a\u514b\u9686\u4e00\u4e0b children\uff0c\u8fd4\u56de children \uff0c\u90a3\u4e48\u672c\u8eab\u4e0d\u4f1a ",l.createElement("code",null,"rerender"),"\u3002")),l.createElement("p",null,"\u5230\u8fd9\u91cc\u7b2c\u4e00\u9636\u6bb5\u5b8c\u6210\u4e86\uff0c\u5b8c\u6210\u4e86\u7ec4\u4ef6\u66f4\u65b0\u6d41\u7a0b\u7684\u6240\u6709\u60c5\u51b5\u3002\u7b2c\u4e00\u9636\u6bb5\u5b8c\u6210\u4f1a\u8fdb\u5165\u5230\u66f4\u65b0\u7684\u7b2c\u4e8c\u9636\u6bb5\u3002"),l.createElement("h3",{id:"3-\u7b2c\u4e8c\u9636\u6bb5"},l.createElement(r.AnchorLink,{to:"#3-\u7b2c\u4e8c\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"3 \u7b2c\u4e8c\u9636\u6bb5"),l.createElement("p",null,"\u4ece beginWork \u7684\u6e90\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u7b2c\u4e8c\u9636\u6bb5\u5c31\u662f\u66f4\u65b0 fiber\uff0c\u6bd4\u5982\u662f\u51fd\u6570\u7ec4\u4ef6\uff0c\u5c31\u4f1a\u8c03\u7528 ",l.createElement("code",null,"updateFunctionComponent"),"\uff0c\u7c7b\u7ec4\u4ef6\u5c31\u8c03\u7528 ",l.createElement("code",null,"updateClassComponent"),"\uff0c\u7136\u540e\u8fdb\u884c rerender \u4e86\u3002"),l.createElement("h3",{id:"4-\u6d41\u7a0b\u603b\u7ed3"},l.createElement(r.AnchorLink,{to:"#4-\u6d41\u7a0b\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"4 \u6d41\u7a0b\u603b\u7ed3"),l.createElement("p",null,"\u63a5\u4e0b\u6765\u4ee5\u4e0a\u8ff0\u4e2d\u7684",l.createElement("strong",null,"\u7ec4\u4ef6B"),"\u4e3a\u4f8b\u5b50\uff0c\u5728\u5f3a\u5316\u4e00\u4e0b\u66f4\u65b0\u6d41\u7a0b\u3002"),l.createElement("p",null,l.createElement("strong",null,"\u573a\u666f\u4e00"),"\uff1a\u5f53\u66f4\u65b0 A \u65f6\u5019\uff0c\u90a3\u4e48 A \u7ec4\u4ef6\u7684 fiber \u4f1a\u8fdb\u5165\u8c03\u548c\u6d41\u7a0b\uff0c\u4f1a\u6267\u884c render \u5f62\u6210\u65b0\u7684\u7ec4\u4ef6 B \u5bf9\u5e94\u7684 element \u5143\u7d20\uff0c\u63a5\u4e0b\u6765\u8c03\u548c B \uff0c\u56e0\u4e3a B \u7684 newProps \u4e0d\u7b49\u4e8e oldProps\uff0c\u6240\u4ee5\u4f1a didReceiveUpdate = true \uff0c\u7136\u540e\u66f4\u65b0\u7ec4\u4ef6\uff0c\u4e5f\u4f1a\u89e6\u53d1 render\u3002\uff08\u8fd9\u91cc\u90fd\u662f\u9ed8\u8ba4\u6ca1\u6709\u6e32\u67d3\u63a7\u5236\u7684\u573a\u666f\uff0c\u6bd4\u5982 memo PureComponent \u7b49 \uff09\uff0c\u8fd9\u6837\u4e5f\u5c31\u89e3\u51b3\u4e86\u6587\u7ae0\u5f00\u5934\u7684\u95ee\u9898\u56db\u3002"),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8a6957eadb24a92992c33aae021815c~tplv-k3u1fbpfcp-watermark.awebp?",alt:"8.jpg"})),l.createElement("p",null,l.createElement("strong",null,"\u573a\u666f\u4e8c"),"\uff1a\u5f53\u66f4\u65b0 B \u65f6\u5019\uff0c\u90a3\u4e48 A \u7ec4\u4ef6\u4f1a\u6807\u8bb0 childLanes\uff0c\u6240\u4ee5 A \u4f1a\u88ab\u8c03\u548c\uff0c\u4f46\u662f\u4e0d\u4f1a render\uff0c\u7136\u540e\u5230\u4e86\u4e3b\u89d2 B \uff0cB \u7531\u4e8e\u65b0\u8001 props \u76f8\u7b49\uff0c\u6240\u4ee5\u4f1a ",l.createElement("code",null,"checkScheduledUpdateOrContext")," \u6d41\u7a0b\uff0c\u5224\u65ad lane \u7b49\u4e8e renderLanes \uff0c\u68c0\u67e5\u5230 lane \u7b49\u4e8e renderLane\uff0c\u6240\u4ee5\u4f1a\u6267\u884c\u66f4\u65b0\uff0c\u89e6\u53d1 render\u3002 C \u7ec4\u4ef6\u4e5f\u5c31\u8ddf\u7740\u66f4\u65b0\u3002"),l.createElement("p",null,l.createElement("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d8b4c1d668d47778b52e3c2c5bc843f~tplv-k3u1fbpfcp-watermark.awebp?",alt:"9.jpg"})),l.createElement("p",null,l.createElement("strong",null,"\u573a\u666f\u4e09"),"\uff1a\u5f53\u66f4\u65b0 C \u65f6\u5019\uff0c\u90a3\u4e48 A \u548c B \u7ec4\u4ef6\u4f1a\u6807\u8bb0 childLanes\uff0c\u6240\u4ee5 A \u548c B \u4f1a\u88ab\u8c03\u548c\uff0c\u4f46\u662f\u4e0d\u4f1a\u66f4\u65b0\uff0c\u7136\u540e\u5230 C \uff0cC \u4f1a\u8d70\u6b63\u5e38\u6d41\u7a0b\u3002"),l.createElement("p",null,l.createElement("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d1bfffd917d4e458c6544ee9aa1ff55~tplv-k3u1fbpfcp-watermark.awebp?",alt:"10.jpg"})),l.createElement("p",null,l.createElement("strong",null,"\u573a\u666f\u56db"),"\uff1a\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\uff0c\u4ec0\u4e48\u65f6\u5019 B \u4f1a\u8df3\u51fa\u8c03\u548c\u6d41\u7a0b\u5462\u3002"),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eaf97e258da4462c8b5ddf85a284e2ca~tplv-k3u1fbpfcp-watermark.awebp?",alt:"11.jpg"})),l.createElement("p",null,"\u5230\u6b64\u4e3a\u6b62\u5b8c\u6210\u4e86\u6574\u4e2a\u66f4\u65b0\u6d41\u7a0b\u3002"),l.createElement("h3",{id:"5-beginwork-\u6d41\u7a0b\u56fe"},l.createElement(r.AnchorLink,{to:"#5-beginwork-\u6d41\u7a0b\u56fe","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"5 beginWork \u6d41\u7a0b\u56fe"),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99afa68f8ab94c93be41df70db0ae488~tplv-k3u1fbpfcp-watermark.awebp?",alt:"3.jpg"})),l.createElement("h2",{id:"\u603b\u7ed3"},l.createElement(r.AnchorLink,{to:"#\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u603b\u7ed3"),l.createElement("p",null,"\u901a\u8fc7\u672c\u7ae0\u8282\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u5e94\u8be5\u638c\u63e1\u7684\u77e5\u8bc6\u70b9\u5982\u4e0b\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u7ec4\u4ef6\u66f4\u65b0\u548c\u8c03\u548c\u8fc7\u7a0b\u3002rerender \u4e00\u5b9a\u4f1a\u8c03\u548c\uff0c\u4f46\u662f\u8c03\u548c\u5e76\u4e0d\u4e00\u5b9a rerender\uff0c\u4e5f\u6709\u53ef\u80fd\u627e\u5230\u5f85\u66f4\u65b0\u7684\u5b50\u5143\u7d20\u3002"),l.createElement("li",null,"\u7ec4\u4ef6\u7c7b\u578b\u7684\u66f4\u65b0\u7684\u51e0\u79cd\u60c5\u51b5\u3002"),l.createElement("li",null,"\u4ece\u51fa\u53d1\u66f4\u65b0\u5230 beginWork \u5168\u6d41\u7a0b\u3002"))))}));n["default"]=e=>{var n=l.useContext(r.context),t=n.demos;return l.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&r.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.createElement(a,{demos:t})}}}]);