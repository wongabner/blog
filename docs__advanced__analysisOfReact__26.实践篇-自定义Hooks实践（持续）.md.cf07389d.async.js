(self["webpackChunkblog"]=self["webpackChunkblog"]||[]).push([[430],{22146:function(e,t,n){"use strict";n.r(t);var l=n(67294),a=n(96089),c=n(65659),r=l.memo((e=>{e.demos;return l.createElement(l.Fragment,null,l.createElement("div",{className:"markdown"},l.createElement("h2",{id:"\u4e00-\u524d\u8a00"},l.createElement(a.AnchorLink,{to:"#\u4e00-\u524d\u8a00","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e00 \u524d\u8a00"),l.createElement("p",null,"\u4e0a\u7ae0\u8282\u8bb2\u5230\u4e86\u81ea\u5b9a\u4e49 hooks \u7684\u7279\u6027\u548c\u8bbe\u8ba1\u539f\u5219\uff0c\u672c\u7ae0\u8282\u5c06\u8bb0\u5f55\u81ea\u5b9a\u4e49 hooks \u4e00\u4e9b\u5177\u4f53\u7684\u5e94\u7528\u573a\u666f\u3002"),l.createElement("h2",{id:"\u4e8c-\u5b9e\u8df5\u4e00\u81ea\u52a8\u4e0a\u62a5pvclick\u7684\u57cb\u70b9hooks-uselog"},l.createElement(a.AnchorLink,{to:"#\u4e8c-\u5b9e\u8df5\u4e00\u81ea\u52a8\u4e0a\u62a5pvclick\u7684\u57cb\u70b9hooks-uselog","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e8c \u5b9e\u8df5\u4e00\uff1a\u81ea\u52a8\u4e0a\u62a5pv/click\u7684\u57cb\u70b9hooks\u2014\u2014 useLog"),l.createElement("p",null,"\u63a5\u4e0b\u6765\u5b9e\u73b0\u4e00\u4e2a\u80fd\u591f\u81ea\u52a8\u4e0a\u62a5 \u70b9\u51fb\u4e8b\u4ef6 | pv \u7684\u81ea\u5b9a\u4e49 hooks \u3002\u901a\u8fc7\u8fd9\u4e2a\u81ea\u5b9a\u4e49 hooks \uff0c\u5c06\u5e26\u6765\u7684\u6536\u83b7\u662f\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u901a\u8fc7\u81ea\u5b9a\u4e49 hooks \u63a7\u5236\u76d1\u542c DOM \u5143\u7d20\u3002"),l.createElement("li",null,"\u5206\u6e05\u81ea\u5b9a\u4e49 hooks \u4f9d\u8d56\u5173\u7cfb\u3002")),l.createElement("p",null,l.createElement("strong",null,"\u7f16\u5199")),l.createElement(c.Z,{code:"export const LogContext = React.createContext({})\n\nexport default function useLog(){\n    /* \u4e00\u4e9b\u516c\u5171\u53c2\u6570 */\n    const message = React.useContext(LogContext)\n    const listenDOM = React.useRef(null)\n\n    /* \u5206\u6e05\u4f9d\u8d56\u5173\u7cfb -> message \u6539\u53d8\uff0c   */\n    const reportMessage = React.useCallback(function(data,type){\n        if(type==='pv'){ // pv \u4e0a\u62a5\n            console.log('\u7ec4\u4ef6 pv \u4e0a\u62a5',message)\n        }else if(type === 'click'){  // \u70b9\u51fb\u4e0a\u62a5\n            console.log('\u7ec4\u4ef6 click \u4e0a\u62a5',message,data)\n        }\n    },[ message ])\n\n    React.useEffect(()=>{\n        const handleClick = function (e){\n            reportMessage(e.target,'click')\n        }\n        if(listenDOM.current){\n            listenDOM.current.addEventListener('click',handleClick)\n        }\n\n        return function (){\n            listenDOM.current && listenDOM.current.removeEventListener('click',handleClick)\n        }\n    },[ reportMessage  ])\n\n    return [ listenDOM , reportMessage  ]\n}",lang:"js"}),l.createElement("ul",null,l.createElement("li",null,"\u7528 ",l.createElement("code",null,"useContext")," \u83b7\u53d6\u57cb\u70b9\u7684\u516c\u5171\u4fe1\u606f\u3002\u5f53\u516c\u5171\u4fe1\u606f\u6539\u53d8\uff0c\u4f1a\u7edf\u4e00\u66f4\u65b0\u3002"),l.createElement("li",null,"\u7528 ",l.createElement("code",null,"useRef")," \u83b7\u53d6 DOM \u5143\u7d20\u3002"),l.createElement("li",null,"\u7528 ",l.createElement("code",null,"useCallback")," \u7f13\u5b58\u4e0a\u62a5\u4fe1\u606f reportMessage \u65b9\u6cd5\uff0c\u91cc\u9762\u83b7\u53d6 useContext \u5185\u5bb9\u3002\u628a context \u4f5c\u4e3a\u4f9d\u8d56\u9879\u3002\u5f53\u4f9d\u8d56\u9879\u6539\u53d8\uff0c\u91cd\u65b0\u58f0\u660e reportMessage \u51fd\u6570\u3002"),l.createElement("li",null,"\u7528 ",l.createElement("code",null,"useEffect"),"\u76d1\u542c DOM \u4e8b\u4ef6\uff0c\u628a reportMessage \u4f5c\u4e3a\u4f9d\u8d56\u9879\uff0c\u5728 useEffect \u4e2d\u8fdb\u884c\u4e8b\u4ef6\u7ed1\u5b9a\uff0c\u8fd4\u56de\u7684\u9500\u6bc1\u51fd\u6570\u7528\u4e8e\u89e3\u9664\u7ed1\u5b9a\u3002")),l.createElement("p",null,l.createElement("strong",null,"\u4f9d\u8d56\u5173\u7cfb\uff1a")," context \u6539\u53d8 -> \u8ba9\u5f15\u5165 context \u7684 reportMessage \u91cd\u65b0\u58f0\u660e -> \u8ba9\u7ed1\u5b9a DOM \u4e8b\u4ef6\u76d1\u542c\u7684 useEffect \u91cc\u9762\u80fd\u591f\u7ed1\u5b9a\u6700\u65b0\u7684 reportMessage \u3002"),l.createElement("p",null,"\u5982\u679c\u4e0a\u8ff0\u6ca1\u6709\u5206\u6e05\u695a\u4f9d\u8d56\u9879\u5173\u7cfb\uff0c\u90a3\u4e48 context \u6539\u53d8\uff0c\u4f1a\u8ba9 reportMessage \u6253\u5370\u4e0d\u5230\u6700\u65b0\u7684 context \u503c\u3002"),l.createElement("p",null,l.createElement("strong",null,"\u4f7f\u7528")),l.createElement(c.Z,{code:"function Home(){\n    const [ dom , reportMessage  ] = useLog()\n    return <div>\n        {/* \u76d1\u542c\u5185\u90e8\u70b9\u51fb */}\n        <div ref={dom} >\n            <p> \u300aReact\u8fdb\u9636\u5b9e\u8df5\u6307\u5357\u300b</p>\n            <button> \u6309\u94ae one   (\u5185\u90e8\u70b9\u51fb) </button>\n            <button> \u6309\u94ae two   (\u5185\u90e8\u70b9\u51fb) </button>\n            <button> \u6309\u94ae three (\u5185\u90e8\u70b9\u51fb)  </button>\n        </div>\n        {/* \u5916\u90e8\u70b9\u51fb */}\n        <button  onClick={()=>{ console.log(reportMessage)  }} > \u5916\u90e8\u70b9\u51fb </button>\n    </div>\n}\nconst Index = React.memo(Home) /*  \u963b\u65ad useState \u7684\u66f4\u65b0\u6548\u5e94  */\nexport default function Root(){\n    const [ value , setValue ] = useState({})\n    return  <LogContext.Provider value={value} >\n        <Index />\n        <button onClick={()=> setValue({ name:'\u300aReact\u8fdb\u9636\u5b9e\u8df5\u6307\u5357\u300b' , author:'\u6211\u4e0d\u662f\u5916\u661f\u4eba'  })} >\u70b9\u51fb</button>\n    </LogContext.Provider>\n}",lang:"js"}),l.createElement("p",null,"\u5982\u4e0a\u5f53 context \u6539\u53d8\uff0c\u80fd\u591f\u8fbe\u5230\u6b63\u5e38\u4e0a\u62a5\u7684\u6548\u679c\u3002\u6709\u4e00\u4e2a\u5c0f\u7ec6\u8282\uff0c\u5c31\u662f\u7528 ",l.createElement("code",null,"React.memo")," \u6765\u963b\u65ad Root \u7ec4\u4ef6\u6539\u53d8 state \u7ed9 Home \u7ec4\u4ef6\u5e26\u6765\u7684\u66f4\u65b0\u6548\u5e94\u3002"),l.createElement("p",null,l.createElement("strong",null,"\u6548\u679c")),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a1a6243523d4b0388d8bc64a1a0b9bc~tplv-k3u1fbpfcp-watermark.awebp",alt:"4.gif"})),l.createElement("h2",{id:"\u4e09-\u5b9e\u8df5\u4e8c\u5e26\u67e5\u8be2\u7684\u5206\u9875\u52a0\u8f7d\u957f\u5217\u8868-usequerytable"},l.createElement(a.AnchorLink,{to:"#\u4e09-\u5b9e\u8df5\u4e8c\u5e26\u67e5\u8be2\u7684\u5206\u9875\u52a0\u8f7d\u957f\u5217\u8868-usequerytable","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e09 \u5b9e\u8df5\u4e8c\uff1a\u5e26\u67e5\u8be2\u7684\u5206\u9875\u52a0\u8f7d\u957f\u5217\u8868\u2014\u2014 useQueryTable"),l.createElement("p",null,"saas \u7ba1\u7406\u7cfb\u7edf\u4e2d\uff0c\u5927\u6982\u7387\u4f1a\u5b58\u5728\u5e26\u67e5\u8be2\u7684\u8868\u683c\u573a\u666f\uff0c\u90a3\u4e48\u53ef\u4e0d\u53ef\u4ee5\u628a\u6574\u4e2a\u8868\u5355\u548c\u8868\u683c\u7684\u6570\u636e\u903b\u8f91\u5c42\u4ea4\u7ed9\u4e00\u4e2a\u81ea\u5b9a\u4e49 hooks \u6765\u641e\u5b9a\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u63a5\u4e0b\u6765\u6240\u6709\u7c7b\u4f3c\u8be5\u529f\u80fd\u7684\u9875\u9762\uff0c\u53ea\u9700\u8981",l.createElement("strong",null,"\u4e00\u4e2a\u81ea\u5b9a\u4e49 hooks + \u516c\u5171\u7ec4\u4ef6 + \u914d\u7f6e\u9879"),"\u5c31\u80fd\u641e\u5b9a\u4e86\u3002"),l.createElement("p",null,"\u63a5\u4e0b\u6765\u5b9e\u73b0\u4e00\u4e2a\u5e26\u67e5\u8be2\u5206\u9875\u7684\u529f\u80fd\uff0c\u628a",l.createElement("strong",null,"\u6240\u6709\u7684\u903b\u8f91"),"\u90fd\u4ea4\u7ed9\u4e00\u4e2a\u81ea\u5b9a\u4e49 hooks \u53bb\u5904\u7406\uff0c\u7ec4\u4ef6\u53ea\u8d1f\u8d23\u63a5\u6536\u81ea\u5b9a\u4e49 hooks \u7684\u72b6\u6001\u3002"),l.createElement("h3",{id:"\u8bbe\u8ba1\u539f\u5219"},l.createElement(a.AnchorLink,{to:"#\u8bbe\u8ba1\u539f\u5219","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u8bbe\u8ba1\u539f\u5219"),l.createElement("p",null,"useQueryTable \u7684\u8bbe\u8ba1\u4e3b\u8981\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u5206\u522b\u4e3a\u8868\u683c\u548c\u67e5\u8be2\u8868\u5355\u3002"),l.createElement("ul",null,l.createElement("li",null,"\u8868\u683c\u8bbe\u8ba1\uff1a\u8868\u683c\u7684\u6570\u636e\u72b6\u6001\u5c42\uff0c\u6539\u53d8\u5206\u9875\u65b9\u6cd5\uff0c\u8bf7\u6c42\u6570\u636e\u7684\u65b9\u6cd5\u3002"),l.createElement("li",null,"\u8868\u5355\u8bbe\u8ba1\uff1a\u8868\u5355\u7684\u72b6\u6001\u5c42\uff0c\u4ee5\u53ca\u6539\u53d8\u8868\u5355\u5355\u5143\u9879\u7684\u65b9\u6cd5\uff0c\u91cd\u7f6e\u8868\u5355\u91cd\u65b0\u8bf7\u6c42\u6570\u636e\u3002")),l.createElement("h3",{id:"\u8bbe\u8ba1\u6a21\u578b\u56fe"},l.createElement(a.AnchorLink,{to:"#\u8bbe\u8ba1\u6a21\u578b\u56fe","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u8bbe\u8ba1\u6a21\u578b\u56fe"),l.createElement("p",null,"\u81ea\u5b9a\u4e49 hooks \u2014\u2014 useQueryTable \u7684\u8bbe\u8ba1\u6a21\u578b\u56fe\u5982\u4e0b\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/213c059f312e45e8bb670602c11bf183~tplv-k3u1fbpfcp-watermark.awebp",alt:"5.jpg"})),l.createElement("h3",{id:"\u4ee3\u7801\u5b9e\u73b0"},l.createElement(a.AnchorLink,{to:"#\u4ee3\u7801\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4ee3\u7801\u5b9e\u73b0"),l.createElement("p",null,l.createElement("strong",null,"\u7f16\u5199\uff1a")),l.createElement(c.Z,{code:"/**\n *\n * @param {*} defaultQuery  \u8868\u5355\u67e5\u8be2\u9ed8\u8ba4\u53c2\u6570\n * @param {*} api           biaog\n */\nfunction useQueryTable(defaultQuery = {},api){\n   /* \u4fdd\u5b58\u67e5\u8be2\u8868\u683c\u8868\u5355\u4fe1\u606f */\n   const formData = React.useRef({})\n   /* \u4fdd\u5b58\u67e5\u8be2\u8868\u683c\u5206\u9875\u4fe1\u606f */\n   const pagination = React.useRef({\n       page:defaultQuery.page || 1,\n       pageSize:defaultQuery.pageSize || 10\n   })\n\n   /* \u5f3a\u5236\u66f4\u65b0 */\n   const [, forceUpdate] = React.useState(null)\n\n   /* \u8bf7\u6c42\u8868\u683c\u6570\u636e */\n   const [tableData, setTableData] = React.useState({\n     data: [],\n     total: 0,\n     current: 1\n  })\n\n   /* \u8bf7\u6c42\u5217\u8868\u6570\u636e */\n   const getList = React.useCallback(async function(payload={}){\n        if(!api) return\n        const data = await api({ ...defaultQuery, ...payload, ...pagination.current,...formData.current}) || {}\n        if (data.code == 200) {\n            setTableData({ list:data.list,current:data.current,total:data.total })\n        } else {}\n   },[ api ]) /* \u4ee5api\u4f5c\u4e3a\u4f9d\u8d56\u9879\uff0c\u5f53api\u6539\u53d8\uff0c\u91cd\u65b0\u58f0\u660egetList */\n\n    /* \u6539\u53d8\u8868\u5355\u5355\u5143\u9879 */\n    const setFormItem = React.useCallback(function (key,value){\n        const form = formData.current\n        form[key] = value\n        forceUpdate({}) /* forceUpdate \u6bcf\u4e00\u6b21\u90fd\u80fd\u66f4\u65b0\uff0c\u4e0d\u4f1a\u9020\u6210 state \u76f8\u7b49\u7684\u60c5\u51b5 */\n   },[])\n\n   /* \u91cd\u7f6e\u8868\u5355 */\n   const reset = React.useCallback(function(){\n        const current = formData.current\n        for (let name in current) {\n            current[name] = ''\n        }\n        pagination.current.page = defaultQuery.page || 1\n        pagination.current.pageSize = defaultQuery.pageSize || 10\n        /* \u8bf7\u6c42\u6570\u636e  */\n        getList()\n   },[ getList ]) /* getList \u4f5c\u4e3a reset \u7684\u4f9d\u8d56\u9879  */\n\n   /* \u5904\u7406\u5206\u9875\u903b\u8f91 */\n   const handerChange = React.useCallback(async function(page,pageSize){\n        pagination.current = {\n            page,\n            pageSize\n        }\n        getList()\n   },[ getList ]) /* getList \u4f5c\u4e3a handerChange \u7684\u4f9d\u8d56\u9879  */\n\n   /* \u521d\u59cb\u5316\u8bf7\u6c42\u6570\u636e */\n   React.useEffect(()=>{\n       getList()\n   },[])\n\n   /* \u7ec4\u5408\u66b4\u9732\u53c2\u6570 */\n   return [\n        {  /* \u7ec4\u5408\u8868\u683c\u72b6\u6001 */\n           tableData,\n           handerChange,\n           getList,\n           pagination:pagination.current\n        },\n        {  /* \u7ec4\u5408\u641c\u7d22\u8868\u5355\u72b6\u6001 */\n            formData:formData.current,\n            setFormItem,\n            reset\n        }\n    ]\n}",lang:"js"}),l.createElement("p",null,l.createElement("strong",null,"\u8bbe\u8ba1\u5206\u6790\uff1a")),l.createElement("p",null,"\u63a5\u6536\u53c2\u6570 \uff1a\u7f16\u5199\u7684\u81ea\u5b9a\u4e49 hooks \u63a5\u6536\u4e24\u4e2a\u53c2\u6570\u3002"),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"defaultQuery"),"\uff1a\u8868\u683c\u7684\u9ed8\u8ba4\u53c2\u6570\uff0c\u6709\u4e9b\u4e1a\u52a1\u8868\u683c\uff0c\u9664\u4e86\u67e5\u8be2\u548c\u5206\u9875\u4e4b\u5916\uff0c\u6709\u4e00\u4e9b\u72ec\u7acb\u7684\u8bf7\u6c42\u53c2\u6570\u3002"),l.createElement("li",null,l.createElement("code",null,"api")," \uff1a api \u4e3a\u8bf7\u6c42\u6570\u636e\u65b9\u6cd5\uff0c\u5185\u90e8\u7528 ",l.createElement("code",null,"Promise")," \u5c01\u88c5\u5904\u7406\u3002")),l.createElement("p",null,"\u6570\u636e\u5c42\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u7528\u7b2c\u4e00\u4e2a useRef \u4fdd\u5b58\u67e5\u8be2\u8868\u5355\u4fe1\u606f formData \u3002 \u7b2c\u4e8c\u4e2a useRef \u4fdd\u5b58\u8868\u683c\u7684\u5206\u9875\u4fe1\u606f pagination \u3002"),l.createElement("li",null,"\u7528\u7b2c\u4e00\u4e2a useState \u505a",l.createElement("strong",null,"\u53d7\u63a7\u8868\u5355\u7ec4\u4ef6\u66f4\u65b0\u89c6\u56fe"),"\u7684\u6e32\u67d3\u51fd\u6570\u3002\u7b2c\u4e8c\u4e2a useState \u4fdd\u5b58\u5e76\u8d1f\u8d23\u66f4\u65b0\u8868\u683c\u7684\u72b6\u6001\u3002")),l.createElement("p",null,"\u63a7\u5236\u5c42\uff1a\u63a7\u5236\u5c42\u4e3a",l.createElement("strong",null,"\u63a7\u5236\u8868\u5355\u8868\u683c\u6574\u4f53\u8054\u52a8"),"\u7684\u65b9\u6cd5\u3002"),l.createElement("ul",null,l.createElement("li",null,"\u7f16\u5199\u5185\u90e8\u548c\u5bf9\u5916\u516c\u5171\u65b9\u6cd5 ",l.createElement("code",null,"getList"),"\uff0c\u65b9\u6cd5\u5185\u90e8\u4f7f\u7528 api \u51fd\u6570\u53d1\u8d77\u8bf7\u6c42\uff0c\u901a\u8fc7 ",l.createElement("code",null,"setTableData")," \u6539\u53d8\u8868\u683c\u6570\u636e\u5c42\u72b6\u6001\uff0c\u7528 ",l.createElement("code",null,"useCallback")," \u505a\u4f18\u5316\u7f13\u5b58\u5904\u7406 \u3002"),l.createElement("li",null,"\u7f16\u5199\u6539\u53d8\u8868\u5355\u5355\u5143\u9879\u7684\u65b9\u6cd5 ",l.createElement("code",null,"setFormItem"),"\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e3b\u8981\u7ed9\u67e5\u8be2\u8868\u5355\u63a7\u4ef6\u4f7f\u7528\uff0c\u5185\u90e8\u6539\u53d8 formData \u5c5e\u6027\uff0c\u5e76\u901a\u8fc7 useState \u66f4\u65b0\u7ec4\u4ef6\uff0c\u6539\u53d8\u8868\u5355\u63a7\u4ef6\u89c6\u56fe\uff0c\u7528 ",l.createElement("code",null,"useCallback")," \u505a\u4f18\u5316\u7f13\u5b58\u5904\u7406\u3002"),l.createElement("li",null,"\u7f16\u5199\u91cd\u7f6e\u8868\u5355\u7684\u65b9\u6cd5 ",l.createElement("code",null,"reset")," \uff0creset \u4f1a\u6e05\u7a7a formData \u5c5e\u6027\u548c\u91cd\u7f6e\u5206\u9875\u7684\u4fe1\u606f\u3002\u7136\u540e\u91cd\u65b0\u8c03\u7528 getList \u8bf7\u6c42\u6570\u636e\uff0c\u7528 ",l.createElement("code",null,"useCallback")," \u505a\u4f18\u5316\u7f13\u5b58\u5904\u7406\u3002"),l.createElement("li",null,"\u7f16\u5199\u7ed9\u8868\u683c\u5206\u9875\u5668\u63d0\u4f9b\u7684\u63a5\u53e3 ",l.createElement("code",null,"handerChange")," \u5185\u90e8\u6539\u53d8\u5206\u9875\u4fe1\u606f\uff0c\u7136\u540e\u91cd\u65b0\u8bf7\u6c42\u6570\u636e\uff0c\u7528 ",l.createElement("code",null,"useCallback")," \u505a\u4f18\u5316\u7f13\u5b58\u5904\u7406\u3002\u3002"),l.createElement("li",null,"\u7528 useEffect \u4f5c\u4e3a\u521d\u59cb\u5316\u8bf7\u6c42\u8868\u683c\u6570\u636e\u7684\u526f\u4f5c\u7528\u3002")),l.createElement("p",null,"\u8fd4\u56de\u72b6\u6001\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u901a\u8fc7\u6570\u7ec4\u628a\u8868\u5355\u548c\u8868\u683c\u7684\u805a\u5408\u72b6\u6001\u66b4\u9732\u51fa\u53bb\u3002")),l.createElement("p",null,"\u6ce8\u610f\u4e8b\u9879\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u8bf7\u6c42\u65b9\u6cd5\u8981\u4e0e\u540e\u7aef\u8fdb\u884c\u5bf9\u9f50\uff0c\u5305\u62ec\u8fd4\u56de\u7684\u53c2\u6570\u7ed3\u6784\uff0c\u6210\u529f\u72b6\u6001\u7801\u7b49\u3002"),l.createElement("li",null,"\u5c5e\u6027\u7684\u58f0\u660e\u8981\u4e0e UI \u7ec4\u4ef6\u5bf9\u9f50\uff0c\u8fd9\u91cc\u7edf\u4e00\u7528\u7684\u662f antd \u91cc\u9762\u7684\u8868\u683c\u548c\u8868\u5355\u63a7\u4ef6\u3002")),l.createElement("p",null,l.createElement("strong",null,"\u4f7f\u7528\uff1a")),l.createElement(c.Z,{code:'/* \u6a21\u62df\u6570\u636e\u8bf7\u6c42 */\nfunction getTableData(payload){\n    return new Promise((resolve)=>{\n        Promise.resolve().then(()=>{\n            const { list } = listData\n            const arr = threeNumberRandom()  // \u751f\u6210\u4e09\u4e2a\u968f\u673a\u6570 \u6a21\u62df\u6570\u636e\u4ea4\u4e92\n            console.log(\'\u8bf7\u6c42\u53c2\u6570\uff1a\',payload)\n            resolve({\n                ...listData,\n                list:[ list[arr[0]],list[arr[1]],list[arr[2]] ],\n                total:list.length,\n                current:payload.page || 1\n            })\n        })\n    })\n}\nfunction Index (){\n    const [ table,form ] = useQueryTable({ pageSize:3 },getTableData)\n    const { formData ,setFormItem , reset  } = form\n    const { pagination , tableData , getList  , handerChange } = table\n    return <div style={{ margin:\'30px\' }} >\n        <div style={{ marginBottom:\'24px\' }} >\n            <Input onChange={(e)=> setFormItem(\'name\',e.target.value)}\n                placeholder="\u8bf7\u8f93\u5165\u540d\u79f0"\n                style={inputStyle}\n                value={formData.name || \'\'}\n            />\n             <Input onChange={(e)=> setFormItem(\'price\',e.target.value)}\n                 placeholder="\u8bf7\u8f93\u5165\u4ef7\u683c"\n                 style={inputStyle}\n                 value={formData.price || \'\'}\n             />\n             <Select onChange={(value) => setFormItem(\'type\',value)}\n                 placeholder="\u8bf7\u9009\u62e9"\n                 style={inputStyle}\n                 value={formData.type}\n             >\n                 <Option value="1" >\u5bb6\u7535</Option>\n                 <Option value="2" >\u751f\u6d3b\u7528\u54c1</Option>\n             </Select>\n            <button className="searchbtn"\n                onClick={() => getList()}\n            >\u63d0\u4ea4</button>\n             <button className="concellbtn"\n                 onClick={reset}\n             >\u91cd\u7f6e</button>\n        </div>\n        {useCallback( <Table\n            columns={columns}\n            dataSource={tableData.list}\n            height="300px"\n            onChange={(res)=>{ handerChange(res.current,res.pageSize) }}\n            pagination={{ ...pagination, total: tableData.total ,current:tableData.current }}\n            rowKey="id"\n                      />,[tableData])}\n    </div>\n}',lang:"js"}),l.createElement("p",null,l.createElement("strong",null,"\u6548\u679c")),l.createElement("p",null,l.createElement("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/636f36676b3f434d84136043fe97002c~tplv-k3u1fbpfcp-watermark.awebp",alt:"6.gif"})),l.createElement("ul",null,l.createElement("li",null,"\u6574\u4e2a\u67e5\u8be2\u8868\u683c\u903b\u8f91\u5c42\u57fa\u672c\u5c31\u4e00\u4e2a\u81ea\u5b9a\u4e49 hooks \u2014\u2014 ",l.createElement("code",null,"useQueryTable")," \u5c31\u641e\u5b9a\u4e86\u3002"),l.createElement("li",null,l.createElement("code",null,"getTableData")," \u6a21\u62df\u4e86\u6570\u636e\u4ea4\u4e92\u8fc7\u7a0b \uff0c\u5176\u5185\u90e8\u7684\u4ee3\u7801\u903b\u8f91\u4e0d\u5fc5\u7ea0\u7ed3 \u3002"),l.createElement("li",null,l.createElement("code",null,"useCallback")," \u5bf9 Table \u7684 React element \u505a\u7f13\u5b58\u5904\u7406\uff0c\u8fd9\u6837\u9891\u7e41\u7684\u8868\u5355\u63a7\u4ef6\u66f4\u65b0\uff0c\u4e0d\u4f1a\u8ba9 Table \u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3\u3002")),l.createElement("h2",{id:"\u56db-\u5b9e\u8df5\u4e09\u5b9e\u73b0react-redux\u529f\u80fd-usecreatestore--useconnect"},l.createElement(a.AnchorLink,{to:"#\u56db-\u5b9e\u8df5\u4e09\u5b9e\u73b0react-redux\u529f\u80fd-usecreatestore--useconnect","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u56db \u5b9e\u8df5\u4e09\uff1a\u5b9e\u73b0React-Redux\u529f\u80fd\u2014\u2014 useCreateStore | useConnect"),l.createElement("p",null,"\u4e0b\u9762\u6211\u5c06\u7528",l.createElement("strong",null,"\u4e24\u4e2a\u81ea\u5b9a\u4e49 hooks \u5b9e\u73b0 ",l.createElement("code",null,"React-Redux")," \u57fa\u672c\u529f\u80fd"),"\u3002 \u4e00\u4e2a\u662f\u6ce8\u5165 Store \u7684 ",l.createElement("code",null,"useCreateStore")," \uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u8d1f\u8d23\u8ba2\u9605\u66f4\u65b0\u7684 ",l.createElement("code",null,"useConnect")," \uff0c\u901a\u8fc7\u8fd9\u4e2a\u5b9e\u8df5 demo \uff0c\u5c06\u6536\u83b7\u4ee5\u4e0b\u77e5\u8bc6\u70b9\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u5982\u4f55\u5c06\u4e0d\u540c\u7ec4\u4ef6\u7684\u81ea\u5b9a\u4e49 hooks \u5efa\u7acb\u901a\u4fe1\uff0c\u5171\u4eab\u72b6\u6001\u3002"),l.createElement("li",null,"\u5408\u7406\u7f16\u5199\u81ea\u5b9a\u4e49 hooks \uff0c \u5206\u6790 hooks \u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u3002")),l.createElement("p",null,"\u9996\u5148\uff0c\u770b\u4e00\u4e0b\u8981\u5b9e\u73b0\u7684\u4e24\u4e2a\u81ea\u5b9a\u4e49 hooks \u5177\u4f53\u529f\u80fd\u3002"),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"useCreateStore")," \u7528\u4e8e\u4ea7\u751f\u4e00\u4e2a\u72b6\u6001 Store \uff0c\u901a\u8fc7 context \u4e0a\u4e0b\u6587\u4f20\u9012 \uff0c\u4e3a\u4e86\u8ba9\u6bcf\u4e00\u4e2a\u81ea\u5b9a\u4e49 hooks ",l.createElement("code",null,"useConnect")," \u90fd\u80fd\u83b7\u53d6 context \u91cc\u9762\u7684\u72b6\u6001\u5c5e\u6027\u3002"),l.createElement("li",null,l.createElement("code",null,"useConnect")," \u4f7f\u7528\u8fd9\u4e2a\u81ea\u5b9a\u4e49 hooks \u7684\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u83b7\u53d6\u6539\u53d8\u72b6\u6001\u7684 dispatch \u65b9\u6cd5\uff0c\u8fd8\u53ef\u4ee5\u8ba2\u9605 state \uff0c\u88ab\u8ba2\u9605\u7684 state \u53d1\u751f\u53d8\u5316\uff0c\u7ec4\u4ef6\u66f4\u65b0\u3002")),l.createElement("h3",{id:"1-\u8bbe\u8ba1\u601d\u8def"},l.createElement(a.AnchorLink,{to:"#1-\u8bbe\u8ba1\u601d\u8def","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"1 \u8bbe\u8ba1\u601d\u8def"),l.createElement("p",null,l.createElement("strong",null,"\u5982\u4f55\u8ba9\u4e0d\u540c\u7ec4\u4ef6\u7684\u81ea\u5b9a\u4e49 hooks \u5171\u4eab\u72b6\u6001\u5e76\u5b9e\u73b0\u901a\u4fe1\u5462\uff1f")),l.createElement("p",null,"\u9996\u5148\u4e0d\u540c\u7ec4\u4ef6\u7684\u81ea\u5b9a\u4e49 hooks \uff0c\u53ef\u4ee5\u901a\u8fc7 ",l.createElement("code",null,"useContext")," \u83b7\u5f97\u5171\u6709\u72b6\u6001\uff0c\u800c\u4e14\u8fd8\u9700\u8981\u5b9e\u73b0\u72b6\u6001\u7ba1\u7406\u548c\u7ec4\u4ef6\u901a\u4fe1\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4e00\u4e2a\u72b6\u6001\u8c03\u5ea6\u4e2d\u5fc3\u6765\u7edf\u4e00\u505a\u8fd9\u4e9b\u4e8b\uff0c\u53ef\u4ee5\u79f0\u4e4b\u4e3a ",l.createElement("code",null,"ReduxHooksStore")," \uff0c\u5b83\u5177\u4f53\u505a\u7684\u4e8b\u60c5\u5982\u4e0b\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u5168\u5c40\u7ba1\u7406 state\uff0c state \u53d8\u5316\uff0c\u901a\u77e5\u5bf9\u5e94\u7ec4\u4ef6\u66f4\u65b0\u3002"),l.createElement("li",null,"\u6536\u96c6\u4f7f\u7528 ",l.createElement("code",null,"useConnect")," \u7ec4\u4ef6\u7684\u4fe1\u606f\u3002\u7ec4\u4ef6\u9500\u6bc1\u8fd8\u8981\u6e05\u9664\u8fd9\u4e9b\u4fe1\u606f\u3002"),l.createElement("li",null,"\u7ef4\u62a4\u5e76\u4f20\u9012\u8d1f\u8d23\u66f4\u65b0\u7684 ",l.createElement("code",null,"dispatch")," \u65b9\u6cd5\u3002"),l.createElement("li",null,"\u4e00\u4e9b\u91cd\u8981 api \u8981\u66b4\u9732\u7ed9 context \u4e0a\u4e0b\u6587\uff0c\u4f20\u9012\u7ed9\u6bcf\u4e00\u4e2a ",l.createElement("code",null,"useConnect"),"\u3002")),l.createElement("h4",{id:"usecreatestore-\u8bbe\u8ba1"},l.createElement(a.AnchorLink,{to:"#usecreatestore-\u8bbe\u8ba1","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"useCreateStore \u8bbe\u8ba1"),l.createElement("p",null,"\u9996\u5148 ",l.createElement("code",null,"useCreateStore")," \u662f\u5728\u9760\u8fd1\u6839\u90e8\u7ec4\u4ef6\u7684\u4f4d\u7f6e\u7684\uff0c \u800c\u4e14\u5168\u5c40\u53ea\u9700\u8981\u4e00\u4e2a\uff0c\u76ee\u7684\u5c31\u662f\u521b\u5efa\u4e00\u4e2a ",l.createElement("code",null,"Store")," \uff0c\u5e76\u901a\u8fc7 ",l.createElement("code",null,"Provider")," \u4f20\u9012\u4e0b\u53bb\u3002"),l.createElement("p",null,"\u4f7f\u7528\uff1a"),l.createElement(c.Z,{code:"const store = useCreateStore( reducer , initState )",lang:"js"}),l.createElement("p",null,"\u53c2\u6570\uff1a"),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"reducer")," \uff1a\u5168\u5c40 reducer\uff0c\u7eaf\u51fd\u6570\uff0c\u4f20\u5165 state \u548c action \uff0c\u8fd4\u56de\u65b0\u7684 state \u3002"),l.createElement("li",null,l.createElement("code",null,"initState")," \uff1a \u521d\u59cb\u5316 state \u3002")),l.createElement("p",null,"\u8fd4\u56de\u503c\uff1a\u4e3a store \u66b4\u9732\u7684\u4e3b\u8981\u529f\u80fd\u51fd\u6570\u3002"),l.createElement("h4",{id:"store\u8bbe\u8ba1"},l.createElement(a.AnchorLink,{to:"#store\u8bbe\u8ba1","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"Store\u8bbe\u8ba1"),l.createElement("p",null,"Store \u4e3a\u4e0a\u8ff0\u6240\u8bf4\u7684\u8c03\u5ea6\u4e2d\u5fc3\uff0c\u63a5\u6536\u5168\u5c40 reducer \uff0c\u5185\u90e8\u7ef4\u62a4\u72b6\u6001 state \uff0c\u8d1f\u8d23\u901a\u77e5\u66f4\u65b0 \uff0c\u6536\u96c6\u7528 useConnect \u7684\u7ec4\u4ef6\u3002"),l.createElement(c.Z,{code:"const Store = new ReduxHooksStore(reducer,initState).exportStore()",lang:"js"}),l.createElement("p",null,"\u53c2\u6570\uff1a\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u900f\u4f20 useCreateStore \u7684\u53c2\u6570\u3002"),l.createElement("h4",{id:"useconnect\u8bbe\u8ba1"},l.createElement(a.AnchorLink,{to:"#useconnect\u8bbe\u8ba1","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"useConnect\u8bbe\u8ba1"),l.createElement("p",null,"\u4f7f\u7528 useConnect \u7684\u7ec4\u4ef6\uff0c\u5c06\u83b7\u5f97 dispatch \u51fd\u6570\uff0c\u7528\u4e8e\u66f4\u65b0 state \uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u7b2c\u4e00\u4e2a\u53c2\u6570\u8ba2\u9605 state \uff0c\u88ab\u8ba2\u9605\u7684 state \u6539\u53d8 \uff0c\u4f1a\u8ba9\u7ec4\u4ef6\u66f4\u65b0\u3002"),l.createElement(c.Z,{code:"// \u8ba2\u9605 state \u4e2d\u7684 number \nconst mapStoreToState = (state)=>({ number: state.number  })\nconst [ state , dispatch ] = useConnect(mapStoreToState)",lang:"js"}),l.createElement("p",null,"\u53c2\u6570\uff1a"),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"mapStoreToState"),"\uff1a\u5c06 Store \u4e2d state \uff0c\u6620\u5c04\u5230\u7ec4\u4ef6\u7684 state \u4e2d\uff0c\u53ef\u4ee5\u505a\u89c6\u56fe\u6e32\u67d3\u4f7f\u7528\u3002"),l.createElement("li",null,"\u5982\u679c\u6ca1\u6709\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48\u53ea\u63d0\u4f9b ",l.createElement("code",null,"dispatch")," \u51fd\u6570\uff0c\u4e0d\u4f1a\u8ba2\u9605 state \u53d8\u5316\u5e26\u6765\u7684\u66f4\u65b0\u3002")),l.createElement("p",null,"\u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u6570\u7ec4\u3002"),l.createElement("ul",null,l.createElement("li",null,"\u6570\u7ec4\u7b2c\u4e00\u9879\uff1a\u4e3a\u6620\u5c04\u7684 state \u7684\u503c\u3002"),l.createElement("li",null,"\u6570\u7ec4\u7b2c\u4e8c\u9879\uff1a\u4e3a\u6539\u53d8 state \u7684 ",l.createElement("code",null,"dispatch")," \u51fd\u6570\u3002")),l.createElement("h4",{id:"\u539f\u7406\u56fe"},l.createElement(a.AnchorLink,{to:"#\u539f\u7406\u56fe","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u539f\u7406\u56fe"),l.createElement("p",null,l.createElement("img",{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/365036e1c9f44c648f6203b9b950c736~tplv-k3u1fbpfcp-watermark.awebp",alt:"7.jpg"})),l.createElement("h3",{id:"2-usecreatestore"},l.createElement(a.AnchorLink,{to:"#2-usecreatestore","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"2 useCreateStore"),l.createElement(c.Z,{code:"export const ReduxContext = React.createContext(null)\n/* \u7528\u4e8e\u4ea7\u751f reduxHooks \u7684 store */\nexport function useCreateStore(reducer,initState){\n   const store = React.useRef(null)\n   /* \u5982\u679c\u5b58\u5728\u2014\u2014\u4e0d\u9700\u8981\u91cd\u65b0\u5b9e\u4f8b\u5316 Store */\n   if(!store.current){\n       store.current  = new ReduxHooksStore(reducer,initState).exportStore()\n   }\n   return store.current\n}",lang:"js"}),l.createElement("p",null,l.createElement("code",null,"useCreateStore")," \u4e3b\u8981\u505a\u7684\u662f\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u63a5\u6536 ",l.createElement("code",null,"reducer")," \u548c ",l.createElement("code",null,"initState")," \uff0c\u901a\u8fc7 ReduxHooksStore \u4ea7\u751f\u4e00\u4e2a store \uff0c\u4e0d\u671f\u671b\u628a store \u5168\u90e8\u66b4\u9732\u7ed9\u4f7f\u7528\u8005\uff0c\u53ea\u9700\u8981\u66b4\u9732\u6838\u5fc3\u7684\u65b9\u6cd5\uff0c\u6240\u4ee5\u8c03\u7528\u5b9e\u4f8b\u4e0b\u7684 ",l.createElement("code",null,"exportStore"),"\u62bd\u79bb\u51fa\u6838\u5fc3\u65b9\u6cd5\u3002"),l.createElement("li",null,"\u4f7f\u7528\u4e00\u4e2a ",l.createElement("code",null,"useRef")," \u4fdd\u5b58\u6838\u5fc3\u65b9\u6cd5\uff0c\u4f20\u9012\u7ed9 ",l.createElement("code",null,"Provider")," \u3002")),l.createElement("h3",{id:"3-\u72b6\u6001\u7ba1\u7406\u8005--reduxhooksstore"},l.createElement(a.AnchorLink,{to:"#3-\u72b6\u6001\u7ba1\u7406\u8005--reduxhooksstore","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"3 \u72b6\u6001\u7ba1\u7406\u8005 \u2014\u2014 ReduxHooksStore"),l.createElement("p",null,"\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u6838\u5fc3\u72b6\u6001 ReduxHooksStore \u3002"),l.createElement(c.Z,{code:"import { unstable_batchedUpdates } from 'react-dom'\nclass ReduxHooksStore {\n    constructor(reducer,initState){\n       this.name = '__ReduxHooksStore__'\n       this.id = 0\n       this.reducer = reducer\n       this.state = initState\n       this.mapConnects = {}\n    }\n    /* \u9700\u8981\u5bf9\u5916\u4f20\u9012\u7684\u63a5\u53e3 */\n    exportStore=()=>{\n        return {\n            dispatch:this.dispatch.bind(this),\n            subscribe:this.subscribe.bind(this),\n            unSubscribe:this.unSubscribe.bind(this),\n            getInitState:this.getInitState.bind(this)\n        }\n    }\n    /* \u83b7\u53d6\u521d\u59cb\u5316 state */\n    getInitState=(mapStoreToState)=>{\n        return mapStoreToState(this.state)\n    }\n    /* \u66f4\u65b0\u9700\u8981\u66f4\u65b0\u7684\u7ec4\u4ef6 */\n    publicRender=()=>{\n        unstable_batchedUpdates(()=>{ /* \u6279\u91cf\u66f4\u65b0 */\n            Object.keys(this.mapConnects).forEach(name=>{\n                const { update } = this.mapConnects[name]\n                update(this.state)\n            })\n        })\n    }\n    /* \u66f4\u65b0 state  */\n    dispatch=(action)=>{\n       this.state = this.reducer(this.state,action)\n       // \u6279\u91cf\u66f4\u65b0\n       this.publicRender()\n    }\n    /* \u6ce8\u518c\u6bcf\u4e2a connect  */\n    subscribe=(connectCurrent)=>{\n        const connectName = this.name + (++this.id)\n        this.mapConnects[connectName] =  connectCurrent\n        return connectName\n    }\n    /* \u89e3\u9664\u7ed1\u5b9a */\n    unSubscribe=(connectName)=>{\n        delete this.mapConnects[connectName]\n    }\n}",lang:"js"}),l.createElement("h4",{id:"\u72b6\u6001"},l.createElement(a.AnchorLink,{to:"#\u72b6\u6001","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u72b6\u6001"),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"reducer"),"\uff1a\u8fd9\u4e2a reducer \u4e3a\u5168\u5c40\u7684 reducer \uff0c\u7531 useCreateStore \u4f20\u5165\u3002"),l.createElement("li",null,l.createElement("code",null,"state"),"\uff1a\u5168\u5c40\u4fdd\u5b58\u7684\u72b6\u6001 state \uff0c\u6bcf\u6b21\u6267\u884c reducer \u4f1a\u5f97\u5230\u65b0\u7684 state \u3002"),l.createElement("li",null,l.createElement("code",null,"mapConnects"),"\uff1a\u91cc\u9762\u4fdd\u5b58\u6bcf\u4e00\u4e2a useConnect \u7ec4\u4ef6\u7684\u66f4\u65b0\u51fd\u6570\u3002\u7528\u4e8e\u6d3e\u53d1 state \u6539\u53d8\u5e26\u6765\u7684\u66f4\u65b0\u3002")),l.createElement("h4",{id:"\u65b9\u6cd5"},l.createElement(a.AnchorLink,{to:"#\u65b9\u6cd5","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u65b9\u6cd5"),l.createElement("p",null,l.createElement("strong",null,"\u8d1f\u8d23\u521d\u59cb\u5316\uff1a")),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"getInitState"),"\uff1a\u8fd9\u4e2a\u65b9\u6cd5\u7ed9\u81ea\u5b9a\u4e49 hooks \u7684 useConnect \u4f7f\u7528\uff0c\u7528\u4e8e\u83b7\u53d6\u521d\u59cb\u5316\u7684 state \u3002"),l.createElement("li",null,l.createElement("code",null,"exportStore"),"\uff1a\u8fd9\u4e2a\u65b9\u6cd5\u7528\u4e8e\u628a ReduxHooksStore \u63d0\u4f9b\u7684\u6838\u5fc3\u65b9\u6cd5\u4f20\u9012\u7ed9\u6bcf\u4e00\u4e2a useConnect \u3002")),l.createElement("p",null,l.createElement("strong",null,"\u8d1f\u8d23\u7ed1\u5b9a\uff5c\u89e3\u7ed1\uff1a")),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"subscribe"),"\uff1a \u7ed1\u5b9a\u6bcf\u4e00\u4e2a\u81ea\u5b9a\u4e49 hooks useConnect \u3002"),l.createElement("li",null,l.createElement("code",null,"unSubscribe"),"\uff1a\u89e3\u9664\u7ed1\u5b9a\u6bcf\u4e00\u4e2a hooks \u3002")),l.createElement("p",null,l.createElement("strong",null,"\u8d1f\u8d23\u66f4\u65b0\uff1a")),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"dispatch"),"\uff1a\u8fd9\u4e2a\u65b9\u6cd5\u63d0\u4f9b\u7ed9\u4e1a\u52a1\u7ec4\u4ef6\u5c42\uff0c\u6bcf\u4e00\u4e2a\u4f7f\u7528 useConnect \u7684\u7ec4\u4ef6\u53ef\u4ee5\u901a\u8fc7 dispatch \u65b9\u6cd5\u6539\u53d8 state \uff0c\u5185\u90e8\u539f\u7406\u662f\u901a\u8fc7\u8c03\u7528 reducer \u4ea7\u751f\u4e00\u4e2a\u65b0\u7684 state \u3002"),l.createElement("li",null,l.createElement("code",null,"publicRender"),"\uff1a\u5f53 state \u6539\u53d8\u9700\u8981\u901a\u77e5\u6bcf\u4e00\u4e2a\u4f7f\u7528 useConnect \u7684\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u662f\u901a\u77e5\u66f4\u65b0\uff0c\u81f3\u4e8e\u7ec4\u4ef6\u9700\u4e0d\u9700\u8981\u66f4\u65b0\uff0c\u90a3\u662f useConnect \u5185\u90e8\u9700\u8981\u5904\u7406\u7684\u4e8b\u60c5\uff0c\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u7ec6\u8282\uff0c\u5c31\u662f\u8003\u8651\u5230 dispatch \u7684\u89e6\u53d1\u573a\u666f\u53ef\u4ee5\u662f\u5f02\u6b65\u72b6\u6001\u4e0b\uff0c\u6240\u4ee5\u7528 React-DOM \u4e2d unstable_batchedUpdates \u5f00\u542f\u6279\u91cf\u66f4\u65b0\u539f\u5219\u3002")),l.createElement("h3",{id:"4-useconnect"},l.createElement(a.AnchorLink,{to:"#4-useconnect","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"4 useConnect"),l.createElement("p",null,"useConnect \u662f\u6574\u4e2a\u529f\u80fd\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u5b83\u8981\u505a\u7684\u4e8b\u60c5\u662f\u83b7\u53d6\u6700\u65b0\u7684 ",l.createElement("code",null,"state")," \uff0c\u7136\u540e\u901a\u8fc7\u8ba2\u9605\u51fd\u6570 ",l.createElement("code",null,"mapStoreToState")," \u5f97\u5230\u8ba2\u9605\u7684 state \uff0c\u5224\u65ad\u8ba2\u9605\u7684 state \u662f\u5426\u53d1\u751f\u53d8\u5316\u3002\u5982\u679c\u53d1\u751f\u53d8\u5316\u6e32\u67d3\u6700\u65b0\u7684 state \u3002"),l.createElement(c.Z,{code:"export function useConnect(mapStoreToState=()=>{}){\n    /* \u83b7\u53d6 Store \u5185\u90e8\u7684\u91cd\u8981\u51fd\u6570 */\n   const contextValue = React.useContext(ReduxContext)\n   const { getInitState , subscribe ,unSubscribe , dispatch } = contextValue\n   /* \u7528\u4e8e\u4f20\u9012\u7ed9\u4e1a\u52a1\u7ec4\u4ef6\u7684 state  */\n   const stateValue = React.useRef(getInitState(mapStoreToState))\n\n   /* \u6e32\u67d3\u51fd\u6570 */\n   const [ , forceUpdate ] = React.useState()\n   /* \u4ea7\u751f */\n   const connectValue = React.useMemo(()=>{\n       const state =  {\n           /* \u7528\u4e8e\u6bd4\u8f83\u4e00\u6b21 dispatch \u4e2d\uff0c\u65b0\u7684 state \u548c \u4e4b\u524d\u7684state \u662f\u5426\u53d1\u751f\u53d8\u5316  */\n           cacheState: stateValue.current,\n           /* \u66f4\u65b0\u51fd\u6570 */\n           update:function (newState) {\n               /* \u83b7\u53d6\u8ba2\u9605\u7684 state */\n               const selectState = mapStoreToState(newState)\n               /* \u6d45\u6bd4\u8f83 state \u662f\u5426\u53d1\u751f\u53d8\u5316\uff0c\u5982\u679c\u53d1\u751f\u53d8\u5316\uff0c */\n               const isEqual = shallowEqual(state.cacheState,selectState)\n               state.cacheState = selectState\n               stateValue.current  = selectState\n               if(!isEqual){\n                   /* \u66f4\u65b0 */\n                   forceUpdate({})\n               }\n           }\n       }\n       return state\n   },[ contextValue ]) // \u5c06 contextValue \u4f5c\u4e3a\u4f9d\u8d56\u9879\u3002\n\n   React.useEffect(()=>{\n       /* \u7ec4\u4ef6\u6302\u8f7d\u2014\u2014\u6ce8\u518c connect */\n       const name =  subscribe(connectValue)\n       return function (){\n            /* \u7ec4\u4ef6\u5378\u8f7d \u2014\u2014 \u89e3\u7ed1 connect */\n           unSubscribe(name)\n       }\n   },[ connectValue ]) /* \u5c06 connectValue \u4f5c\u4e3a useEffect \u7684\u4f9d\u8d56\u9879 */\n\n   return [ stateValue.current , dispatch ]\n}",lang:"js"}),l.createElement("p",null,l.createElement("strong",null,"\u521d\u59cb\u5316")),l.createElement("ul",null,l.createElement("li",null,"\u7528 useContext \u83b7\u53d6\u4e0a\u4e0b\u6587\u4e2d\uff0c ReduxHooksStore \u63d0\u4f9b\u7684\u6838\u5fc3\u51fd\u6570\u3002"),l.createElement("li",null,"\u7528 useRef \u6765\u4fdd\u5b58\u5f97\u5230\u7684\u6700\u65b0\u7684 state \u3002"),l.createElement("li",null,"\u7528 useState \u4ea7\u751f\u4e00\u4e2a\u66f4\u65b0\u51fd\u6570 ",l.createElement("code",null,"forceUpdate")," \uff0c\u8fd9\u4e2a\u51fd\u6570\u53ea\u662f\u66f4\u65b0\u7ec4\u4ef6\u3002")),l.createElement("p",null,l.createElement("strong",null,"\u6ce8\u518c\uff5c\u89e3\u7ed1\u6d41\u7a0b")),l.createElement("ul",null,l.createElement("li",null,"\u6ce8\u518c\uff1a \u901a\u8fc7 ",l.createElement("code",null,"useEffect")," \u6765\u5411 ReduxHooksStore \u4e2d\u6ce8\u518c\u5f53\u524d useConnect \u4ea7\u751f\u7684 connectValue \uff0cconnectValue \u662f\u4ec0\u4e48\u9a6c\u4e0a\u4f1a\u8bb2\u5230\u3002subscribe \u7528\u4e8e\u6ce8\u518c\uff0c\u4f1a\u8fd4\u56de\u5f53\u524d connectValue \u7684\u552f\u4e00\u6807\u8bc6 name \u3002"),l.createElement("li",null,"\u89e3\u7ed1\uff1a\u5728 useEffect \u7684\u9500\u6bc1\u51fd\u6570\u4e2d\uff0c\u53ef\u4ee5\u7528\u8c03\u7528 unSubscribe \u4f20\u5165 name \u6765\u89e3\u7ed1\u5f53\u524d\u7684 connectValue")),l.createElement("p",null,l.createElement("strong",null,"connectValue\u662f\u5426\u66f4\u65b0\u7ec4\u4ef6")),l.createElement("ul",null,l.createElement("li",null,"connectValue \uff1a\u771f\u6b63\u5730\u5411 ReduxHooksStore \u6ce8\u518c\u7684\u72b6\u6001\uff0c\u9996\u5148\u7528 ",l.createElement("code",null,"useMemo")," \u6765\u5bf9 connectValue \u505a\u7f13\u5b58\uff0cconnectValue \u4e3a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u91cc\u9762\u7684 cacheState \u4fdd\u7559\u4e86\u4e0a\u4e00\u6b21\u7684 mapStoreToState \u4ea7\u751f\u7684 state \uff0c\u8fd8\u6709\u4e00\u4e2a\u8d1f\u8d23\u66f4\u65b0\u7684 update \u51fd\u6570\u3002"),l.createElement("li",null,l.createElement("strong",null,"\u66f4\u65b0\u6d41\u7a0b")," \uff1a \u5f53\u89e6\u53d1 ",l.createElement("code",null,"dispatch")," \u5728 ReduxHooksStore \u4e2d\uff0c\u4f1a\u8ba9\u6bcf\u4e00\u4e2a connectValue \u7684 update \u90fd\u6267\u884c\uff0c update \u4f1a\u89e6\u53d1\u6620\u5c04\u51fd\u6570 ",l.createElement("code",null,"mapStoreToState")," \u6765\u5f97\u5230\u5f53\u524d\u7ec4\u4ef6\u60f3\u8981\u7684 state \u5185\u5bb9\u3002\u7136\u540e\u901a\u8fc7 ",l.createElement("code",null,"shallowEqual")," \u6d45\u6bd4\u8f83\u65b0\u8001 state \u662f\u5426\u53d1\u751f\u53d8\u5316\uff0c\u5982\u679c\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u66f4\u65b0\u7ec4\u4ef6\u3002\u5b8c\u6210\u6574\u4e2a\u6d41\u7a0b\u3002"),l.createElement("li",null,"shallowEqual \uff1a \u8fd9\u4e2a\u6d45\u6bd4\u8f83\u5c31\u662f React \u91cc\u9762\u7684\u6d45\u6bd4\u8f83\uff0c\u5728\u7b2c 11 \u7ae0\u5df2\u7ecf\u8bb2\u4e86\u5176\u6d41\u7a0b\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8bb2\u4e86\u3002")),l.createElement("p",null,l.createElement("strong",null,"\u5206\u6e05\u4f9d\u8d56\u5173\u7cfb")),l.createElement("ul",null,l.createElement("li",null,"\u9996\u5148\u81ea\u5b9a\u4e49 hooks useConnect \u7684\u4f9d\u8d56\u5173\u7cfb\u662f\u4e0a\u4e0b\u6587 contextValue \u6539\u53d8\uff0c\u90a3\u4e48\u8bf4\u660e store \u53d1\u751f\u53d8\u5316\uff0c\u6240\u4ee5\u91cd\u65b0\u901a\u8fc7 useMemo \u4ea7\u751f\u65b0\u7684 connectValue \u3002",l.createElement("strong",null,"\u6240\u4ee5 useMemo \u4f9d\u8d56 contextValue\u3002")),l.createElement("li",null,"connectValue \u6539\u53d8\uff0c\u90a3\u4e48\u9700\u8981\u89e3\u9664\u539f\u6765\u7684\u7ed1\u5b9a\u5173\u7cfb\uff0c\u91cd\u65b0\u7ed1\u5b9a\u3002",l.createElement("strong",null,"useEffect \u4f9d\u8d56 connectValue\u3002"))),l.createElement("p",null,l.createElement("strong",null,"\u5c40\u9650\u6027")),l.createElement("p",null,"\u6574\u4e2a useConnect \u6709\u4e00\u4e9b\u5c40\u9650\u6027\uff0c\u6bd4\u5982\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u6ca1\u6709\u8003\u8651 mapStoreToState \u53ef\u53d8\u6027\uff0c\u65e0\u6cd5\u52a8\u6001\u4f20\u5165 mapStoreToState \u3002"),l.createElement("li",null,"\u6d45\u6bd4\u8f83\uff0c\u4e0d\u80fd\u6df1\u5c42\u6b21\u6bd4\u8f83\u5f15\u7528\u6570\u636e\u7c7b\u578b\u3002")),l.createElement("h3",{id:"5-\u4f7f\u7528\u4e0e\u9a8c\u8bc1\u6548\u679c"},l.createElement(a.AnchorLink,{to:"#5-\u4f7f\u7528\u4e0e\u9a8c\u8bc1\u6548\u679c","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"5 \u4f7f\u7528\u4e0e\u9a8c\u8bc1\u6548\u679c"),l.createElement("p",null,"\u63a5\u4e0b\u6765\u5c31\u662f\u9a8c\u8bc1\u6548\u679c\u73af\u8282\uff0c\u6211\u6a21\u62df\u4e86\u7ec4\u4ef6\u901a\u4fe1\u7684\u573a\u666f\u3002"),l.createElement("h4",{id:"\u6839\u90e8\u7ec4\u4ef6\u6ce8\u5165-store"},l.createElement(a.AnchorLink,{to:"#\u6839\u90e8\u7ec4\u4ef6\u6ce8\u5165-store","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u6839\u90e8\u7ec4\u4ef6\u6ce8\u5165 Store"),l.createElement(c.Z,{code:"import { ReduxContext , useConnect , useCreateStore } from './hooks/useRedux'\nfunction  Index(){\n    const [ isShow , setShow ] =  React.useState(true)\n    console.log('index \u6e32\u67d3')\n    return <div>\n        <CompA />\n        <CompB />\n        <CompC />\n        {isShow &&  <CompD />}\n        <button onClick={() => setShow(!isShow)} >\u70b9\u51fb</button>\n    </div>\n}\n\nfunction Root(){\n    const store = useCreateStore(function(state,action){\n        const { type , payload } =action\n        if(type === 'setA' ){\n            return {\n                ...state,\n                mesA:payload\n            }\n        }else if(type === 'setB'){\n            return {\n                ...state,\n                mesB:payload\n            }\n        }else if(type === 'clear'){ //\u6e05\u7a7a\n            return  { mesA:'',mesB:'' }\n        }\n        else{\n            return state\n        }\n    },\n    { mesA:'111',mesB:'111' })\n    return <div>\n        <ReduxContext.Provider value={store} >\n            <Index/>\n        </ReduxContext.Provider>\n    </div>\n}",lang:"js"}),l.createElement("p",null,l.createElement("strong",null,"Root\u6839\u7ec4\u4ef6")),l.createElement("ul",null,l.createElement("li",null,"\u901a\u8fc7 useCreateStore \u521b\u5efa\u4e00\u4e2a store \uff0c\u4f20\u5165 reducer \u548c \u521d\u59cb\u5316\u7684\u503c ",l.createElement("code",null,"{"," mesA:'111',mesB:'111' ","}")),l.createElement("li",null,"\u7528 Provider \u4f20\u9012 store\u3002")),l.createElement("p",null,l.createElement("strong",null,"Index\u7ec4\u4ef6")),l.createElement("ul",null,l.createElement("li",null,"\u6709\u56db\u4e2a\u5b50\u7ec4\u4ef6 CompA \uff0c CompB \uff0cCompC \uff0cCompD \u3002\u5176\u4e2d CompD \u662f \u52a8\u6001\u6302\u8f7d\u7684\u3002")),l.createElement("h4",{id:"\u4e1a\u52a1\u7ec4\u4ef6\u4f7f\u7528"},l.createElement(a.AnchorLink,{to:"#\u4e1a\u52a1\u7ec4\u4ef6\u4f7f\u7528","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e1a\u52a1\u7ec4\u4ef6\u4f7f\u7528"),l.createElement(c.Z,{code:"function CompA(){\n    const [ value ,setValue ] = useState('')\n    const [state ,dispatch ] = useConnect((state)=> ({ mesB : state.mesB }) )\n    return <div className=\"component_box\" >\n        <p> \u7ec4\u4ef6A</p>\n        <p>\u7ec4\u4ef6B\u5bf9\u6211\u8bf4 \uff1a {state.mesB} </p>\n        <input onChange={(e)=>setValue(e.target.value)}\n            placeholder=\"\u5bf9B\u7ec4\u4ef6\u8bf4\"\n        />\n        <button onClick={()=> dispatch({ type:'setA' ,payload:value })} >\u786e\u5b9a</button>\n    </div>\n}\n\nfunction CompB(){\n    const [ value ,setValue ] = useState('')\n    const [state ,dispatch ] = useConnect((state)=> ({ mesA : state.mesA }) )\n    return <div className=\"component_box\" >\n        <p> \u7ec4\u4ef6B</p>\n        <p>\u7ec4\u4ef6A\u5bf9\u6211\u8bf4 \uff1a {state.mesA} </p>\n        <input onChange={(e)=>setValue(e.target.value)}\n            placeholder=\"\u5bf9A\u7ec4\u4ef6\u8bf4\"\n        />\n        <button onClick={()=> dispatch({ type:'setB' ,payload:value })} >\u786e\u5b9a</button>\n    </div>\n}\n\nfunction CompC(){\n    const [state  ] = useConnect((state)=> ({ mes1 : state.mesA,mes2 : state.mesB }) )\n    return <div className=\"component_box\" >\n        <p>\u7ec4\u4ef6A \uff1a {state.mes1} </p>\n        <p>\u7ec4\u4ef6B \uff1a {state.mes2} </p>\n    </div>\n}\n\nfunction CompD(){\n    const [ ,dispatch  ] = useConnect( )\n    console.log('D \u7ec4\u4ef6\u66f4\u65b0')\n    return <div className=\"component_box\" >\n        <button onClick={()=> dispatch({ type:'clear' })} > \u6e05\u7a7a </button>\n    </div>\n}",lang:"js"}),l.createElement("ul",null,l.createElement("li",null,"CompA \u548c CompB \u6a21\u62df\u7ec4\u4ef6\u53cc\u5411\u901a\u4fe1\u3002"),l.createElement("li",null,"CompC \u7ec4\u4ef6\u63a5\u6536 CompA \u548c CompB \u901a\u4fe1\u5185\u5bb9\uff0c\u5e76\u6620\u5c04\u5230 ",l.createElement("code",null,"mes1 \uff0cmes2")," \u5c5e\u6027\u4e0a\u3002"),l.createElement("li",null,"CompD \u6ca1\u6709 mapStoreToState \uff0c\u6ca1\u6709\u8ba2\u9605 state \uff0cstate \u53d8\u5316\u7ec4\u4ef6\u4e0d\u4f1a\u66f4\u65b0\uff0c\u53ea\u662f\u7528 dispatch \u6e05\u7a7a\u72b6\u6001\u3002")),l.createElement("h4",{id:"\u6548\u679c"},l.createElement(a.AnchorLink,{to:"#\u6548\u679c","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u6548\u679c"),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7b06820f28f461c91620d7240b63ed5~tplv-k3u1fbpfcp-watermark.awebp",alt:"8.gif"})),l.createElement("h2",{id:"\u4e94-\u6301\u7eed\u66f4\u65b0\u4e2d"},l.createElement(a.AnchorLink,{to:"#\u4e94-\u6301\u7eed\u66f4\u65b0\u4e2d","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e94 \u6301\u7eed\u66f4\u65b0\u4e2d\uff5e"),l.createElement("p",null,"\u672c\u7ae0\u8282\uff0c\u7b2c\u4e8c\u5341\u516d\u7ae0\u8282\uff0c\u7b2c\u5341\u56db\u7ae0\u8282\u4e3a\u6301\u7eed\u7ef4\u62a4\u7ae0\u8282\uff0c\u4f1a\u6709\u66f4\u591a\u7cbe\u5f69\u7684\u81ea\u5b9a\u4e49 hooks \u5b9e\u8df5\u573a\u666f\u3002"),l.createElement("h2",{id:"\u516d-\u603b\u7ed3"},l.createElement(a.AnchorLink,{to:"#\u516d-\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u516d \u603b\u7ed3"),l.createElement("p",null,"\u672c\u7ae0\u8282\u4e3a\u5b9e\u8df5\u7ae0\u8282\uff0c\u8bb0\u5f55\u4e86\u771f\u5b9e\u5de5\u4f5c\u4e2d\u4f7f\u7528\u7684\u81ea\u5b9a\u4e49 hooks \u573a\u666f\uff0c\u8fd8\u6709\u4e00\u4e9b\u81ea\u5b9a\u4e49 hooks \u5de7\u5999\u8bbe\u8ba1\u601d\u8def\u3002")))}));t["default"]=e=>{var t=l.useContext(a.context),n=t.demos;return l.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&a.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.createElement(r,{demos:n})}}}]);