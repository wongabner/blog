(self["webpackChunkblog"]=self["webpackChunkblog"]||[]).push([[8605],{55532:function(e,t,n){"use strict";n.r(t);var l=n(67294),r=n(96089),c=n(65659),a=l.memo((e=>{e.demos;return l.createElement(l.Fragment,null,l.createElement("div",{className:"markdown"},l.createElement("h2",{id:"\u4e00-\u524d\u8a00"},l.createElement(r.AnchorLink,{to:"#\u4e00-\u524d\u8a00","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e00 \u524d\u8a00"),l.createElement("p",null,"\u5728\u4e4b\u524d\u7684\u5f88\u591a\u7ae0\u8282\u4e2d\uff0c\u6211\u4eec\u90fd\u63d0\u5230\u4e86 React fiber \uff0c\u7406\u89e3 fiber \u662f\u5403\u900f React \u539f\u7406\u7684\u57fa\u77f3\uff0c\u6240\u4ee5\u8fd9\u8282\u5c06\u91cd\u70b9\u4ecb\u7ecd\u4e00\u4e0b React Fiber \u3002"),l.createElement("p",null,"\u901a\u8fc7\u672c\u7ae0\u8282\uff0c\u4f60\u4f1a\u5b66\u5230 React fiber \u539f\u7406\uff0c\u4ee5\u53ca React \u8c03\u548c\u7684\u4e24\u5927\u9636\u6bb5\uff0c\u89e3\u51b3\u9762\u8bd5\u4e2d\u9047\u5230\u7684 fiber \u95ee\u9898\u3002"),l.createElement("p",null,"\u53c2\u8003\u95ee\u9898\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u4ec0\u4e48\u662ffiber ? Fiber \u67b6\u6784\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898\uff1f"),l.createElement("li",null,"Fiber root \u548c root fiber \u6709\u4ec0\u4e48\u533a\u522b\uff1f"),l.createElement("li",null,"\u4e0d\u540cfiber \u4e4b\u95f4\u5982\u4f55\u5efa\u7acb\u8d77\u5173\u8054\u7684\uff1f"),l.createElement("li",null,"React \u8c03\u548c\u6d41\u7a0b\uff1f"),l.createElement("li",null,"\u4e24\u5927\u9636\u6bb5 commit \u548c render \u90fd\u505a\u4e86\u54ea\u4e9b\u4e8b\u60c5\uff1f"),l.createElement("li",null,"\u4ec0\u4e48\u662f\u53cc\u7f13\u51b2\u6811\uff1f \u6709\u4ec0\u4e48\u4f5c\u7528\uff1f"),l.createElement("li",null,"Fiber \u6df1\u5ea6\u904d\u5386\u6d41\u7a0b\uff1f"),l.createElement("li",null,"Fiber\u7684\u8c03\u548c\u80fd\u4e2d\u65ad\u5417\uff1f \u5982\u4f55\u4e2d\u65ad\uff1f")),l.createElement("p",null,l.createElement("strong",null,"\u4ec0\u4e48\u662ffiber")),l.createElement("p",null,"Fiber \u7684\u82f1\u6587\u7684\u662f\u2019\u7ea4\u7ef4\u2018\uff0cfiber \u8bde\u751f\u5728 ",l.createElement("code",null,"Reactv16")," \u7248\u672c\uff0c\u6574\u4e2a React \u56e2\u961f\u82b1\u8d39\u4e24\u5e74\u65f6\u95f4\u91cd\u6784 fiber \u67b6\u6784\uff0c\u76ee\u7684\u5c31\u662f\u89e3\u51b3\u5927\u578b React \u5e94\u7528\u5361\u987f\uff1bfiber \u5728 React \u4e2d\u662f\u6700\u5c0f\u7c92\u5ea6\u7684\u6267\u884c\u5355\u5143\uff0c\u65e0\u8bba React \u8fd8\u662f Vue \uff0c\u5728\u904d\u5386\u66f4\u65b0\u6bcf\u4e00\u4e2a\u8282\u70b9\u7684\u65f6\u5019\u90fd\u4e0d\u662f\u7528\u7684\u771f\u5b9e DOM \uff0c\u90fd\u662f\u91c7\u7528\u865a\u62df DOM \uff0c\u6240\u4ee5\u53ef\u4ee5\u7406\u89e3\u6210 fiber \u5c31\u662f React \u7684\u865a\u62df DOM \u3002"),l.createElement("p",null,l.createElement("strong",null,"\u4e3a\u4ec0\u4e48\u8981\u7528fiber")),l.createElement("p",null,"\u5728 ",l.createElement("code",null,"Reactv15")," \u4ee5\u53ca\u4e4b\u524d\u7684\u7248\u672c\uff0cReact \u5bf9\u4e8e\u865a\u62df DOM \u662f\u91c7\u7528\u9012\u5f52\u65b9\u5f0f\u904d\u5386\u66f4\u65b0\u7684\uff0c\u6bd4\u5982\u4e00\u6b21\u66f4\u65b0\uff0c\u5c31\u4f1a\u4ece\u5e94\u7528\u6839\u90e8\u9012\u5f52\u66f4\u65b0\uff0c\u9012\u5f52\u4e00\u65e6\u5f00\u59cb\uff0c\u4e2d\u9014\u65e0\u6cd5\u4e2d\u65ad\uff0c\u968f\u7740\u9879\u76ee\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u5c42\u7ea7\u8d8a\u6765\u8d8a\u6df1\uff0c\u5bfc\u81f4\u66f4\u65b0\u7684\u65f6\u95f4\u8d8a\u6765\u8d8a\u957f\uff0c\u7ed9\u524d\u7aef\u4ea4\u4e92\u4e0a\u7684\u4f53\u9a8c\u5c31\u662f\u5361\u987f\u3002"),l.createElement("p",null,l.createElement("code",null,"Reactv16")," \u4e3a\u4e86\u89e3\u51b3\u5361\u987f\u95ee\u9898\u5f15\u5165\u4e86 fiber \uff0c\u4e3a\u4ec0\u4e48\u5b83\u80fd\u89e3\u51b3\u5361\u987f\uff0c\u66f4\u65b0 fiber \u7684\u8fc7\u7a0b\u53eb\u505a ",l.createElement("code",null,"Reconciler"),"\uff08\u8c03\u548c\u5668\uff09\uff0c\u6bcf\u4e00\u4e2a fiber \u90fd\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u6267\u884c\u5355\u5143\u6765\u5904\u7406\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a fiber \u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u7684\u8fc7\u671f\u65f6\u95f4",l.createElement("code",null,"expirationTime"),"\uff08 v17 \u7248\u672c\u53eb\u505a\u4f18\u5148\u7ea7 ",l.createElement("code",null,"lane")," \uff09\u6765\u5224\u65ad\u662f\u5426\u8fd8\u6709\u7a7a\u95f4\u65f6\u95f4\u6267\u884c\u66f4\u65b0\uff0c\u5982\u679c\u6ca1\u6709\u65f6\u95f4\u66f4\u65b0\uff0c\u5c31\u8981\u628a\u4e3b\u52a8\u6743\u4ea4\u7ed9\u6d4f\u89c8\u5668\u53bb\u6e32\u67d3\uff0c\u505a\u4e00\u4e9b\u52a8\u753b\uff0c\u91cd\u6392\uff08 reflow \uff09\uff0c\u91cd\u7ed8 repaints \u4e4b\u7c7b\u7684\u4e8b\u60c5\uff0c\u8fd9\u6837\u5c31\u80fd\u7ed9\u7528\u6237\u611f\u89c9\u4e0d\u662f\u5f88\u5361\u3002\u7136\u540e\u7b49\u6d4f\u89c8\u5668\u7a7a\u4f59\u65f6\u95f4\uff0c\u5728\u901a\u8fc7 ",l.createElement("code",null,"scheduler")," \uff08\u8c03\u5ea6\u5668\uff09\uff0c\u518d\u6b21\u6062\u590d\u6267\u884c\u5355\u5143\u4e0a\u6765\uff0c\u8fd9\u6837\u5c31\u80fd\u672c\u8d28\u4e0a\u4e2d\u65ad\u4e86\u6e32\u67d3\uff0c\u63d0\u9ad8\u4e86\u7528\u6237\u4f53\u9a8c\u3002"),l.createElement("h2",{id:"\u4e8c-\u5168\u9762\u8ba4\u8bc6fiber"},l.createElement(r.AnchorLink,{to:"#\u4e8c-\u5168\u9762\u8ba4\u8bc6fiber","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e8c \u5168\u9762\u8ba4\u8bc6Fiber"),l.createElement("h3",{id:"1-elementfiberdom\u4e09\u79cd\u4ec0\u4e48\u5173\u7cfb"},l.createElement(r.AnchorLink,{to:"#1-elementfiberdom\u4e09\u79cd\u4ec0\u4e48\u5173\u7cfb","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"1 element,fiber,dom\u4e09\u79cd\u4ec0\u4e48\u5173\u7cfb\uff1f"),l.createElement("p",null,"\u9996\u5148\u5fc5\u987b\u9700\u8981\u5f04\u660e\u767d React.element \uff0cfiber \u548c\u771f\u5b9e DOM \u4e09\u8005\u662f\u4ec0\u4e48\u5173\u7cfb\u3002"),l.createElement("ul",null,l.createElement("li",null,"element \u662f React \u89c6\u56fe\u5c42\u5728\u4ee3\u7801\u5c42\u7ea7\u4e0a\u7684\u8868\u8c61\uff0c\u4e5f\u5c31\u662f\u5f00\u53d1\u8005\u5199\u7684 jsx \u8bed\u6cd5\uff0c\u5199\u7684\u5143\u7d20\u7ed3\u6784\uff0c\u90fd\u4f1a\u88ab\u521b\u5efa\u6210 element \u5bf9\u8c61\u7684\u5f62\u5f0f\u3002\u4e0a\u9762\u4fdd\u5b58\u4e86 props \uff0c children \u7b49\u4fe1\u606f\u3002"),l.createElement("li",null,"DOM \u662f\u5143\u7d20\u5728\u6d4f\u89c8\u5668\u4e0a\u7ed9\u7528\u6237\u76f4\u89c2\u7684\u8868\u8c61\u3002"),l.createElement("li",null,"fiber \u53ef\u4ee5\u8bf4\u662f\u662f element \u548c\u771f\u5b9e DOM \u4e4b\u95f4\u7684\u4ea4\u6d41\u67a2\u7ebd\u7ad9\uff0c\u4e00\u65b9\u9762\u6bcf\u4e00\u4e2a\u7c7b\u578b element \u90fd\u4f1a\u6709\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u7684 fiber \u7c7b\u578b\uff0celement \u53d8\u5316\u5f15\u8d77\u66f4\u65b0\u6d41\u7a0b\u90fd\u662f\u901a\u8fc7 fiber \u5c42\u9762\u505a\u4e00\u6b21\u8c03\u548c\u6539\u53d8\uff0c\u7136\u540e\u5bf9\u4e8e\u5143\u7d20\uff0c\u5f62\u6210\u65b0\u7684 DOM \u505a\u89c6\u56fe\u6e32\u67d3\u3002")),l.createElement("p",null,"\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a90368f24f0477aaf0d446a8f6736db~tplv-k3u1fbpfcp-watermark.awebp",alt:"2.jpg"})),l.createElement("p",null,"\u9996\u5148\u5148\u6765\u770b\u4e00\u4e0b element \u4e0e fiber \u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb\u3002"),l.createElement(c.Z,{code:"export const FunctionComponent = 0;       // \u5bf9\u5e94\u51fd\u6570\u7ec4\u4ef6\nexport const ClassComponent = 1;          // \u5bf9\u5e94\u7684\u7c7b\u7ec4\u4ef6\nexport const IndeterminateComponent = 2;  // \u521d\u59cb\u5316\u7684\u65f6\u5019\u4e0d\u77e5\u9053\u662f\u51fd\u6570\u7ec4\u4ef6\u8fd8\u662f\u7c7b\u7ec4\u4ef6 \nexport const HostRoot = 3;                // Root Fiber \u53ef\u4ee5\u7406\u89e3\u4e3a\u8ddf\u5143\u7d20 \uff0c \u901a\u8fc7reactDom.render()\u4ea7\u751f\u7684\u6839\u5143\u7d20\nexport const HostPortal = 4;              // \u5bf9\u5e94  ReactDOM.createPortal \u4ea7\u751f\u7684 Portal \nexport const HostComponent = 5;           // dom \u5143\u7d20 \u6bd4\u5982 <div>\nexport const HostText = 6;                // \u6587\u672c\u8282\u70b9\nexport const Fragment = 7;                // \u5bf9\u5e94 <React.Fragment> \nexport const Mode = 8;                    // \u5bf9\u5e94 <React.StrictMode>   \nexport const ContextConsumer = 9;         // \u5bf9\u5e94 <Context.Consumer>\nexport const ContextProvider = 10;        // \u5bf9\u5e94 <Context.Provider>\nexport const ForwardRef = 11;             // \u5bf9\u5e94 React.ForwardRef\nexport const Profiler = 12;               // \u5bf9\u5e94 <Profiler/ >\nexport const SuspenseComponent = 13;      // \u5bf9\u5e94 <Suspense>\nexport const MemoComponent = 14;          // \u5bf9\u5e94 React.memo \u8fd4\u56de\u7684\u7ec4\u4ef6",lang:"js"}),l.createElement("h3",{id:"2-fiber\u4fdd\u5b58\u4e86\u90a3\u4e9b\u4fe1\u606f"},l.createElement(r.AnchorLink,{to:"#2-fiber\u4fdd\u5b58\u4e86\u90a3\u4e9b\u4fe1\u606f","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"2 fiber\u4fdd\u5b58\u4e86\u90a3\u4e9b\u4fe1\u606f"),l.createElement("p",null,"\u521a\u624d\u8bf4\u5230 fiber \u4f5c\u4e3a element \u548c\u771f\u5b9e DOM \u5143\u7d20\u7684\u6c9f\u901a\u67a2\u7ebd\uff0c\u90a3\u4e48\u4e00\u4e2a fiber \u4e0a\u5230\u5e95\u4fdd\u5b58\u4e86\u90a3\u4e9b\u4fe1\u606f\u5462\uff1f"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiber.js")),l.createElement(c.Z,{code:"function FiberNode(){\n\n  this.tag = tag;                  // fiber \u6807\u7b7e \u8bc1\u660e\u662f\u4ec0\u4e48\u7c7b\u578bfiber\u3002\n  this.key = key;                  // key\u8c03\u548c\u5b50\u8282\u70b9\u65f6\u5019\u7528\u5230\u3002 \n  this.type = null;                // dom\u5143\u7d20\u662f\u5bf9\u5e94\u7684\u5143\u7d20\u7c7b\u578b\uff0c\u6bd4\u5982div\uff0c\u7ec4\u4ef6\u6307\u5411\u7ec4\u4ef6\u5bf9\u5e94\u7684\u7c7b\u6216\u8005\u51fd\u6570\u3002  \n  this.stateNode = null;           // \u6307\u5411\u5bf9\u5e94\u7684\u771f\u5b9edom\u5143\u7d20\uff0c\u7c7b\u7ec4\u4ef6\u6307\u5411\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u53ef\u4ee5\u88abref\u83b7\u53d6\u3002\n \n  this.return = null;              // \u6307\u5411\u7236\u7ea7fiber\n  this.child = null;               // \u6307\u5411\u5b50\u7ea7fiber\n  this.sibling = null;             // \u6307\u5411\u5144\u5f1ffiber \n  this.index = 0;                  // \u7d22\u5f15\n\n  this.ref = null;                 // ref\u6307\u5411\uff0cref\u51fd\u6570\uff0c\u6216\u8005ref\u5bf9\u8c61\u3002\n\n  this.pendingProps = pendingProps;// \u5728\u4e00\u6b21\u66f4\u65b0\u4e2d\uff0c\u4ee3\u8868element\u521b\u5efa\n  this.memoizedProps = null;       // \u8bb0\u5f55\u4e0a\u4e00\u6b21\u66f4\u65b0\u5b8c\u6bd5\u540e\u7684props\n  this.updateQueue = null;         // \u7c7b\u7ec4\u4ef6\u5b58\u653esetState\u66f4\u65b0\u961f\u5217\uff0c\u51fd\u6570\u7ec4\u4ef6\u5b58\u653e\n  this.memoizedState = null;       // \u7c7b\u7ec4\u4ef6\u4fdd\u5b58state\u4fe1\u606f\uff0c\u51fd\u6570\u7ec4\u4ef6\u4fdd\u5b58hooks\u4fe1\u606f\uff0cdom\u5143\u7d20\u4e3anull\n  this.dependencies = null;        // context\u6216\u662f\u65f6\u95f4\u7684\u4f9d\u8d56\u9879\n\n  this.mode = mode;                //\u63cf\u8ff0fiber\u6811\u7684\u6a21\u5f0f\uff0c\u6bd4\u5982 ConcurrentMode \u6a21\u5f0f\n\n  this.effectTag = NoEffect;       // effect\u6807\u7b7e\uff0c\u7528\u4e8e\u6536\u96c6effectList\n  this.nextEffect = null;          // \u6307\u5411\u4e0b\u4e00\u4e2aeffect\n\n  this.firstEffect = null;         // \u7b2c\u4e00\u4e2aeffect\n  this.lastEffect = null;          // \u6700\u540e\u4e00\u4e2aeffect\n\n  this.expirationTime = NoWork;    // \u901a\u8fc7\u4e0d\u540c\u8fc7\u671f\u65f6\u95f4\uff0c\u5224\u65ad\u4efb\u52a1\u662f\u5426\u8fc7\u671f\uff0c \u5728v17\u7248\u672c\u7528lane\u8868\u793a\u3002\n\n  this.alternate = null;           //\u53cc\u7f13\u5b58\u6811\uff0c\u6307\u5411\u7f13\u5b58\u7684fiber\u3002\u66f4\u65b0\u9636\u6bb5\uff0c\u4e24\u9897\u6811\u4e92\u76f8\u4ea4\u66ff\u3002\n}",lang:"js"}),l.createElement("p",null,"\u5982\u4e0a\uff0c\u6211\u628a fiber \u4e2d\u6bcf\u4e00\u4e2a\u53d8\u91cf\u4ee3\u8868\u4ec0\u4e48\uff0c\u90fd\u5199\u51fa\u6765\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u53c2\u8003\u4e00\u4e0b\u3002"),l.createElement("h3",{id:"3-\u6bcf\u4e00\u4e2afiber\u5982\u4f55\u5efa\u7acb\u8d77\u5173\u8054\u7684"},l.createElement(r.AnchorLink,{to:"#3-\u6bcf\u4e00\u4e2afiber\u5982\u4f55\u5efa\u7acb\u8d77\u5173\u8054\u7684","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"3 \u6bcf\u4e00\u4e2afiber\u5982\u4f55\u5efa\u7acb\u8d77\u5173\u8054\u7684"),l.createElement("p",null,"\u770b\u8fc7\u4e4b\u524d\u7ae0\u8282\u7684\u670b\u53cb\u90fd\u77e5\u9053\u5bf9\u4e8e\u6bcf\u4e00\u4e2a element \u90fd\u4f1a\u5bf9\u5e94\u4e00\u4e2a fiber \uff0c\u6bcf\u4e00\u4e2a fiber \u662f\u901a\u8fc7 return \uff0c child \uff0csibling \u4e09\u4e2a\u5c5e\u6027\u5efa\u7acb\u8d77\u8054\u7cfb\u7684\u3002"),l.createElement("ul",null,l.createElement("li",null,"return\uff1a \u6307\u5411\u7236\u7ea7 Fiber \u8282\u70b9\u3002"),l.createElement("li",null,"child\uff1a \u6307\u5411\u5b50 Fiber \u8282\u70b9\u3002"),l.createElement("li",null,"sibling\uff1a\u6307\u5411\u5144\u5f1f fiber \u8282\u70b9\u3002")),l.createElement("p",null,"\u6bd4\u5982\u9879\u76ee\u4e2d\u5143\u7d20\u7ed3\u6784\u662f\u8fd9\u6837\u7684\uff1a"),l.createElement(c.Z,{code:"export default class Index extends React.Component{\n   state={ number:666 } \n   handleClick=()=>{\n     this.setState({\n         number:this.state.number + 1\n     })\n   }\n   render(){\n     return <div>\n       hello\uff0cworld\n       <p > \u300aReact\u8fdb\u9636\u5b9e\u8df5\u6307\u5357\u300b { this.state.number } \ud83d\udc4d  </p>\n       <button onClick={ this.handleClick } >\u70b9\u8d5e</button>\n     </div>\n   }\n}",lang:"js"}),l.createElement("p",null,l.createElement("strong",null,"fiber\u5bf9\u5e94\u7684\u5173\u7cfb\u5982\u4e0b")),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4bdf7dc554e54197a98bbc9be5b191b2~tplv-k3u1fbpfcp-watermark.awebp",alt:"1.jpg"})),l.createElement("h2",{id:"\u4e09-fiber\u66f4\u65b0\u673a\u5236"},l.createElement(r.AnchorLink,{to:"#\u4e09-fiber\u66f4\u65b0\u673a\u5236","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e09 Fiber\u66f4\u65b0\u673a\u5236"),l.createElement("h3",{id:"1-\u521d\u59cb\u5316"},l.createElement(r.AnchorLink,{to:"#1-\u521d\u59cb\u5316","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"1 \u521d\u59cb\u5316"),l.createElement("p",null,"\u65e2\u7136\u4e0a\u8ff0\u660e\u767d\u4e86 fiber \u91cc\u9762\u6709\u4ec0\u4e48\uff0c\u4ee5\u53ca fiber \u4e4b\u95f4\u662f\u5982\u4f55\u5efa\u7acb\u8d77\u5173\u8054\u7684\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u8981\u4ece\u521d\u59cb\u5316\u548c\u4e00\u6b21\u66f4\u65b0\u5165\u624b\uff0c\u770b\u4e00\u4e0b fiber \u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002"),l.createElement("p",null,l.createElement("strong",null,"\u7b2c\u4e00\u6b65\uff1a\u521b\u5efafiberRoot\u548crootFiber")),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"fiberRoot"),"\uff1a\u9996\u6b21\u6784\u5efa\u5e94\u7528\uff0c \u521b\u5efa\u4e00\u4e2a fiberRoot \uff0c\u4f5c\u4e3a\u6574\u4e2a React \u5e94\u7528\u7684\u6839\u57fa\u3002"),l.createElement("li",null,l.createElement("code",null,"rootFiber"),"\uff1a \u5982\u4e0b\u901a\u8fc7 ReactDOM.render \u6e32\u67d3\u51fa\u6765\u7684\uff0c\u5982\u4e0a Index \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a rootFiber\u3002\u4e00\u4e2a React \u5e94\u7528\u53ef\u4ee5\u6709\u591a ReactDOM.render \u521b\u5efa\u7684 rootFiber \uff0c\u4f46\u662f\u53ea\u80fd\u6709\u4e00\u4e2a fiberRoot\uff08\u5e94\u7528\u6839\u8282\u70b9\uff09\u3002")),l.createElement(c.Z,{code:"ReactDOM.render(<Index/>, document.getElementById('app'));",lang:"js"}),l.createElement("p",null,"\u7b2c\u4e00\u6b21\u6302\u8f7d\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u5c06 fiberRoot \u548c rootFiber \u5efa\u7acb\u8d77\u5173\u8054\u3002"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberRoot.js")),l.createElement(c.Z,{code:"function createFiberRoot(containerInfo,tag){\n    /* \u521b\u5efa\u4e00\u4e2aroot */\n    const root = new FiberRootNode(containerInfo,tag)\n    const rootFiber = createHostRootFiber(tag);\n    root.current = rootFiber\n    return root\n}",lang:"js"}),l.createElement("p",null,"\u6548\u679c\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb68640d39914c03bc77ea15616c7918~tplv-k3u1fbpfcp-watermark.awebp",alt:"3.jpg"})),l.createElement("p",null,l.createElement("strong",null,"\u7b2c\u4e8c\u6b65\uff1aworkInProgress\u548ccurrent")),l.createElement("p",null,"\u7ecf\u8fc7\u7b2c\u4e00\u6b65\u7684\u5904\u7406\uff0c\u5f00\u59cb\u5230\u6b63\u5f0f\u6e32\u67d3\u9636\u6bb5\uff0c\u4f1a\u8fdb\u5165 beginwork \u6d41\u7a0b\uff0c\u5728\u8bb2\u6e32\u67d3\u6d41\u7a0b\u4e4b\u524d\uff0c\u8981\u5148\u5f04\u660e\u767d\u4e24\u4e2a\u6982\u5ff5\uff1a"),l.createElement("ul",null,l.createElement("li",null,"workInProgress\u662f\uff1a\u6b63\u5728\u5185\u5b58\u4e2d\u6784\u5efa\u7684 Fiber \u6811\u79f0\u4e3a workInProgress Fiber \u6811\u3002\u5728\u4e00\u6b21\u66f4\u65b0\u4e2d\uff0c\u6240\u6709\u7684\u66f4\u65b0\u90fd\u662f\u53d1\u751f\u5728 workInProgress \u6811\u4e0a\u3002\u5728\u4e00\u6b21\u66f4\u65b0\u4e4b\u540e\uff0cworkInProgress \u6811\u4e0a\u7684\u72b6\u6001\u662f\u6700\u65b0\u7684\u72b6\u6001\uff0c\u90a3\u4e48\u5b83\u5c06\u53d8\u6210 current \u6811\u7528\u4e8e\u6e32\u67d3\u89c6\u56fe\u3002"),l.createElement("li",null,"current\uff1a\u6b63\u5728\u89c6\u56fe\u5c42\u6e32\u67d3\u7684\u6811\u53eb\u505a current \u6811\u3002")),l.createElement("p",null,"\u63a5\u4e0b\u6765\u4f1a\u5230 rootFiber \u7684\u6e32\u67d3\u6d41\u7a0b\uff0c\u9996\u5148\u4f1a\u590d\u7528\u5f53\u524d current \u6811\uff08 rootFiber \uff09\u7684 ",l.createElement("code",null,"alternate")," \u4f5c\u4e3a workInProgress \uff0c\u5982\u679c\u6ca1\u6709 alternate \uff08\u521d\u59cb\u5316\u7684 rootFiber \u662f\u6ca1\u6709 alternate \uff09\uff0c\u90a3\u4e48\u4f1a\u521b\u5efa\u4e00\u4e2a fiber \u4f5c\u4e3a workInProgress \u3002\u4f1a\u7528 alternate \u5c06\u65b0\u521b\u5efa\u7684 workInProgress \u4e0e current \u6811\u5efa\u7acb\u8d77\u5173\u8054\u3002\u8fd9\u4e2a\u5173\u8054\u8fc7\u7a0b\u53ea\u6709\u521d\u59cb\u5316\u7b2c\u4e00\u6b21\u521b\u5efa alternate \u65f6\u5019\u8fdb\u884c\u3002"),l.createElement(c.Z,{code:"currentFiber.alternate = workInProgressFiber\nworkInProgressFiber.alternate = currentFiber",lang:"js"}),l.createElement("p",null,"\u6548\u679c\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a7f5a9b77ff45febd8e255fcba1ba3a~tplv-k3u1fbpfcp-watermark.awebp",alt:"4.jpg"})),l.createElement("p",null,l.createElement("strong",null,"\u7b2c\u4e09\u6b65\uff1a\u6df1\u5ea6\u8c03\u548c\u5b50\u8282\u70b9\uff0c\u6e32\u67d3\u89c6\u56fe")),l.createElement("p",null,"\u63a5\u4e0b\u6765\u4f1a\u6309\u7167\u4e0a\u8ff0\u7b2c\u4e8c\u6b65\uff0c\u5728\u65b0\u521b\u5efa\u7684 alternates \u4e0a\uff0c\u5b8c\u6210\u6574\u4e2a fiber \u6811\u7684\u904d\u5386\uff0c\u5305\u62ec fiber \u7684\u521b\u5efa\u3002"),l.createElement("p",null,"\u6548\u679c\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cda0522c0c85435494ccf3a3ea587baa~tplv-k3u1fbpfcp-watermark.awebp",alt:"5.jpg"})),l.createElement("p",null,"\u6700\u540e\u4f1a\u4ee5 workInProgress \u4f5c\u4e3a\u6700\u65b0\u7684\u6e32\u67d3\u6811\uff0cfiberRoot \u7684 current \u6307\u9488\u6307\u5411 workInProgress \u4f7f\u5176\u53d8\u4e3a current Fiber \u6811\u3002\u5230\u6b64\u5b8c\u6210\u521d\u59cb\u5316\u6d41\u7a0b\u3002"),l.createElement("p",null,"\u6548\u679c\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/907fb4f6768842438e0df7f083adc4b6~tplv-k3u1fbpfcp-watermark.awebp",alt:"6.jpg"})),l.createElement("h3",{id:"2-\u66f4\u65b0"},l.createElement(r.AnchorLink,{to:"#2-\u66f4\u65b0","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"2 \u66f4\u65b0"),l.createElement("p",null,"\u5982\u679c\u5bf9\u4e8e\u4e0a\u8ff0 demo \uff0c\u5f00\u53d1\u8005\u70b9\u51fb\u4e00\u6b21\u6309\u94ae\u53d1\u751f\u66f4\u65b0\uff0c\u63a5\u4e0b\u6765\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462? \u9996\u5148\u4f1a\u8d70\u5982\u4e0a\u7684\u903b\u8f91\uff0c\u91cd\u65b0\u521b\u5efa\u4e00\u9897 workInProgresss \u6811\uff0c\u590d\u7528\u5f53\u524d current \u6811\u4e0a\u7684 alternate \uff0c\u4f5c\u4e3a\u65b0\u7684 workInProgress \uff0c\u7531\u4e8e\u521d\u59cb\u5316 rootfiber \u6709 alternate \uff0c\u6240\u4ee5\u5bf9\u4e8e\u5269\u4f59\u7684\u5b50\u8282\u70b9\uff0cReact \u8fd8\u9700\u8981\u521b\u5efa\u4e00\u4efd\uff0c\u548c current \u6811\u4e0a\u7684 fiber \u5efa\u7acb\u8d77 alternate \u5173\u8054\u3002\u6e32\u67d3\u5b8c\u6bd5\u540e\uff0cworkInProgresss \u518d\u6b21\u53d8\u6210 current \u6811\u3002"),l.createElement("p",null,"\u6548\u679c\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff00ce5f2db0430c841ea3a01754542e~tplv-k3u1fbpfcp-watermark.awebp",alt:"7.jpg"})),l.createElement("p",null,l.createElement("strong",null,"\uff5c--------\u95ee\u4e0e\u7b54--------\uff5c"),"\u95ee\uff1a\u5982\u679c\u5982\u4e0a\u53c8\u53d1\u751f\u4e00\u6b21\u70b9\u51fb\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f"),l.createElement("p",null,"\u7b54\uff1a\u5982\u679c\u8fdb\u884c\u4e0b\u4e00\u6b21\u66f4\u65b0\uff0c\u90a3\u4e48\u4f1a\u5c06 current \u7684 alternate \u4f5c\u4e3a\u57fa\u7840\uff08\u5982\u56fe\u53f3\u6811\uff09\uff0c\u590d\u5236\u4e00\u4efd\u4f5c\u4e3a workInProgresss \uff0c\u7136\u540e\u8fdb\u884c\u66f4\u65b0\u3002"),l.createElement("p",null,l.createElement("strong",null,"\uff5c--------end---------|")),l.createElement("h3",{id:"\u53cc\u7f13\u51b2\u6811"},l.createElement(r.AnchorLink,{to:"#\u53cc\u7f13\u51b2\u6811","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u53cc\u7f13\u51b2\u6811"),l.createElement("p",null,"canvas \u7ed8\u5236\u52a8\u753b\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0a\u4e00\u5e27\u8ba1\u7b97\u91cf\u6bd4\u8f83\u5927\uff0c\u5bfc\u81f4\u6e05\u9664\u4e0a\u4e00\u5e27\u753b\u9762\u5230\u7ed8\u5236\u5f53\u524d\u5e27\u753b\u9762\u4e4b\u95f4\u6709\u8f83\u957f\u95f4\u9699\uff0c\u5c31\u4f1a\u51fa\u73b0\u767d\u5c4f\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0ccanvas \u5728\u5185\u5b58\u4e2d\u7ed8\u5236\u5f53\u524d\u52a8\u753b\uff0c\u7ed8\u5236\u5b8c\u6bd5\u540e\u76f4\u63a5\u7528\u5f53\u524d\u5e27\u66ff\u6362\u4e0a\u4e00\u5e27\u753b\u9762\uff0c\u7531\u4e8e\u7701\u53bb\u4e86\u4e24\u5e27\u66ff\u6362\u95f4\u7684\u8ba1\u7b97\u65f6\u95f4\uff0c\u4e0d\u4f1a\u51fa\u73b0\u4ece\u767d\u5c4f\u5230\u51fa\u73b0\u753b\u9762\u7684\u95ea\u70c1\u60c5\u51b5\u3002\u8fd9\u79cd\u5728\u5185\u5b58\u4e2d\u6784\u5efa\u5e76\u76f4\u63a5\u66ff\u6362\u7684\u6280\u672f\u53eb\u505a",l.createElement("strong",null,"\u53cc\u7f13\u5b58"),"\u3002"),l.createElement("p",null,"React \u7528 workInProgress \u6811(\u5185\u5b58\u4e2d\u6784\u5efa\u7684\u6811) \u548c current (\u6e32\u67d3\u6811) \u6765\u5b9e\u73b0\u66f4\u65b0\u903b\u8f91\u3002\u53cc\u7f13\u5b58\u4e00\u4e2a\u5728\u5185\u5b58\u4e2d\u6784\u5efa\uff0c\u4e00\u4e2a\u6e32\u67d3\u89c6\u56fe\uff0c\u4e24\u9897\u6811\u7528 alternate \u6307\u9488\u76f8\u4e92\u6307\u5411\uff0c\u5728\u4e0b\u4e00\u6b21\u6e32\u67d3\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u590d\u7528\u7f13\u5b58\u6811\u505a\u4e3a\u4e0b\u4e00\u6b21\u6e32\u67d3\u6811\uff0c\u4e0a\u4e00\u6b21\u7684\u6e32\u67d3\u6811\u53c8\u4f5c\u4e3a\u7f13\u5b58\u6811\uff0c\u8fd9\u6837\u53ef\u4ee5\u9632\u6b62\u53ea\u7528\u4e00\u9897\u6811\u66f4\u65b0\u72b6\u6001\u7684\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u53c8\u52a0\u5feb\u4e86 DOM \u8282\u70b9\u7684\u66ff\u6362\u4e0e\u66f4\u65b0\u3002"),l.createElement("h2",{id:"\u56db-\u4e24\u5927\u9636\u6bb5render\u548ccommit"},l.createElement(r.AnchorLink,{to:"#\u56db-\u4e24\u5927\u9636\u6bb5render\u548ccommit","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u56db \u4e24\u5927\u9636\u6bb5\uff1arender\u548ccommit"),l.createElement("p",null,"render \u9636\u6bb5\u548c commit \u9636\u6bb5\u662f\u6574\u4e2a fiber Reconciler \u7684\u6838\u5fc3\uff0c\u63a5\u4e0b\u6765\u7814\u7a76\u4e00\u4e0b\u4e24\u4e2a\u9636\u6bb5\u80fd\u505a\u4e9b\u4ec0\u4e48\uff1f\u5728\u6b63\u5f0f\u8bb2\u89e3\u4e4b\u524d\uff0c\u6709\u5fc5\u8981\u770b\u4e00\u4e0b\u6574\u4e2a fiber \u7684\u904d\u5386\u5f00\u59cb\u2014\u2014 workLoop \uff0c\u90a3\u4e48\u9996\u5148\u770b\u4e00\u4e0b workLoop \u3002"),l.createElement("h3",{id:"1-render\u9636\u6bb5"},l.createElement(r.AnchorLink,{to:"#1-render\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"1 render\u9636\u6bb5"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.js")),l.createElement(c.Z,{code:"function workLoop (){\n    while (workInProgress !== null ) {\n      workInProgress = performUnitOfWork(workInProgress);\n    }\n}",lang:"js"}),l.createElement("p",null,"\u4e0a\u8ff0\u5df2\u7ecf\u8bf4\u4e86\uff0c\u6bcf\u4e00\u4e2a fiber \u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a\u6267\u884c\u7684\u5355\u5143\uff0c\u5728\u8c03\u548c\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u53d1\u751f\u66f4\u65b0\u7684 fiber \u90fd\u4f1a\u4f5c\u4e3a\u4e00\u6b21 workInProgress \u3002\u90a3\u4e48 workLoop \u5c31\u662f\u6267\u884c\u6bcf\u4e00\u4e2a\u5355\u5143\u7684\u8c03\u5ea6\u5668\uff0c\u5982\u679c\u6e32\u67d3\u6ca1\u6709\u88ab\u4e2d\u65ad\uff0c\u90a3\u4e48 workLoop \u4f1a\u904d\u5386\u4e00\u904d fiber \u6811\u3002 performUnitOfWork \u5305\u62ec\u4e24\u4e2a\u9636\u6bb5 beginWork \u548c completeWork \u3002"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.js")),l.createElement(c.Z,{code:"function performUnitOfWork(){\n    next = beginWork(current, unitOfWork, renderExpirationTime);\n    if (next === null) {\n       next = completeUnitOfWork(unitOfWork);\n    }\n}",lang:"js"}),l.createElement("p",null,l.createElement("code",null,"beginWork"),"\uff1a\u662f\u5411\u4e0b\u8c03\u548c\u7684\u8fc7\u7a0b\u3002\u5c31\u662f\u7531 fiberRoot \u6309\u7167 child \u6307\u9488\u9010\u5c42\u5411\u4e0b\u8c03\u548c\uff0c\u671f\u95f4\u4f1a\u6267\u884c\u51fd\u6570\u7ec4\u4ef6\uff0c\u5b9e\u4f8b\u7c7b\u7ec4\u4ef6\uff0cdiff \u8c03\u548c\u5b50\u8282\u70b9\uff0c\u6253\u4e0d\u540ceffectTag\u3002"),l.createElement("p",null,l.createElement("code",null,"completeUnitOfWork"),"\uff1a\u662f\u5411\u4e0a\u5f52\u5e76\u7684\u8fc7\u7a0b\uff0c\u5982\u679c\u6709\u5144\u5f1f\u8282\u70b9\uff0c\u4f1a\u8fd4\u56de sibling\u5144\u5f1f\uff0c\u6ca1\u6709\u8fd4\u56de return \u7236\u7ea7\uff0c\u4e00\u76f4\u8fd4\u56de\u5230 fiebrRoot \uff0c\u671f\u95f4\u53ef\u4ee5\u5f62\u6210effectList\uff0c\u5bf9\u4e8e\u521d\u59cb\u5316\u6d41\u7a0b\u4f1a\u521b\u5efa DOM \uff0c\u5bf9\u4e8e DOM \u5143\u7d20\u8fdb\u884c\u4e8b\u4ef6\u6536\u96c6\uff0c\u5904\u7406style\uff0cclassName\u7b49\u3002"),l.createElement("p",null,"\u8fd9\u4e48\u4e00\u4e0a\u4e00\u4e0b\uff0c\u6784\u6210\u4e86\u6574\u4e2a fiber \u6811\u7684\u8c03\u548c\u3002"),l.createElement("h4",{id:"\u5411\u4e0b\u8c03\u548cbeginwork"},l.createElement(r.AnchorLink,{to:"#\u5411\u4e0b\u8c03\u548cbeginwork","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u5411\u4e0b\u8c03\u548cbeginWork"),l.createElement("p",null,"\u5148\u6765\u770b\u4e00\u4e0b beginwork \u5230\u5e95\u505a\u4e86\u4e9b\u4ec0\u4e48\uff1f"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberBeginWork.js")),l.createElement(c.Z,{code:"function beginWork(current,workInProgress){\n\n    switch(workInProgress.tag){\n       case IndeterminateComponent:{// \u521d\u59cb\u5316\u7684\u65f6\u5019\u4e0d\u77e5\u9053\u662f\u51fd\u6570\u7ec4\u4ef6\u8fd8\u662f\u7c7b\u7ec4\u4ef6 \n           //....\n       }\n       case FunctionComponent: {//\u5bf9\u5e94\u51fd\u6570\u7ec4\u4ef6\n           //....\n       }\n       case ClassComponent:{  //\u7c7b\u7ec4\u4ef6\n           //...\n       }\n       case HostComponent:{\n           //...  \n       }\n       ...\n    }\n}",lang:"js"}),l.createElement("p",null,"\u5230\u8fd9\u91cc\u628a\u4e4b\u524d\u8bb2\u7684\u7ae0\u8282\u4e32\u8054\u8d77\u6765\uff0c\u5728\u751f\u547d\u5468\u671f\u7ae0\u8282\uff0c\u4e3b\u8981\u8bb2\u4e86 ",l.createElement("code",null,"ClassComponent"),"\uff0c\u5728\u7b2c\u5341\u516b\u7ae0\u8282\u8bb2\u4e86 ",l.createElement("code",null,"FunctionComponent")," \uff0c\u603b\u7ed3beginWork \u4f5c\u7528\u5982\u4e0b\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u5bf9\u4e8e\u7ec4\u4ef6\uff0c\u6267\u884c\u90e8\u5206\u751f\u547d\u5468\u671f\uff0c\u6267\u884c render \uff0c\u5f97\u5230\u6700\u65b0\u7684 children \u3002"),l.createElement("li",null,"\u5411\u4e0b\u904d\u5386\u8c03\u548c children \uff0c\u590d\u7528 oldFiber ( diff \u7b97\u6cd5)\uff0cdiff \u6d41\u7a0b\u5728\u7b2c\u5341\u4e8c\u7ae0\u5df2\u7ecf\u8bb2\u8fc7\u4e86\u3002"),l.createElement("li",null,"\u6253\u4e0d\u540c\u7684\u526f\u4f5c\u7528\u6807\u7b7e effectTag \uff0c\u6bd4\u5982\u7c7b\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\uff0c\u6216\u8005\u5143\u7d20\u7684\u589e\u52a0\uff0c\u5220\u9664\uff0c\u66f4\u65b0\u3002")),l.createElement("p",null,l.createElement("strong",null,"reconcileChildren")),l.createElement("p",null,"\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b React \u662f\u5982\u4f55\u8c03\u548c\u5b50\u8282\u70b9\u7684\uff1a"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberBeginWork.js")),l.createElement(c.Z,{code:"function reconcileChildren(current,workInProgress){\n   if(current === null){  /* \u521d\u59cb\u5316\u5b50\u4ee3fiber  */\n        workInProgress.child = mountChildFibers(workInProgress,null,nextChildren,renderExpirationTime)\n   }else{  /* \u66f4\u65b0\u6d41\u7a0b\uff0cdiff children\u5c06\u5728\u8fd9\u91cc\u8fdb\u884c\u3002 */\n        workInProgress.child = reconcileChildFibers(workInProgress,current.child,nextChildren,renderExpirationTime)\n   }\n}",lang:"js"}),l.createElement("p",null,l.createElement("strong",null,"EffectTag")," \u6211\u5217\u4e3e\u51e0\u4e2a\u5e38\u7528\u7684 effectTag \u3002"),l.createElement(c.Z,{code:"export const Placement = /*             */ 0b0000000000010;  // \u63d2\u5165\u8282\u70b9\nexport const Update = /*                */ 0b0000000000100;  // \u66f4\u65b0fiber\nexport const Deletion = /*              */ 0b0000000001000;  // \u5220\u9664fiebr\nexport const Snapshot = /*              */ 0b0000100000000;  // \u5feb\u7167\nexport const Passive = /*               */ 0b0001000000000;  // useEffect\u7684\u526f\u4f5c\u7528\nexport const Callback = /*              */ 0b0000000100000;  // setState\u7684 callback\nexport const Ref = /*                   */ 0b0000010000000;  // ref",lang:"js"}),l.createElement("h4",{id:"\u5411\u4e0a\u5f52\u5e76-completeunitofwork"},l.createElement(r.AnchorLink,{to:"#\u5411\u4e0a\u5f52\u5e76-completeunitofwork","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u5411\u4e0a\u5f52\u5e76 completeUnitOfWork"),l.createElement("p",null,"completeUnitOfWork \u7684\u6d41\u7a0b\u662f\u81ea\u4e0b\u5411\u4e0a\u7684\uff0c\u90a3\u4e48 completeUnitOfWork \u8fc7\u7a0b\u4e3b\u8981\u505a\u5199\u4ec0\u4e48\u5462\uff1f"),l.createElement("ul",null,l.createElement("li",null,"\u9996\u5148 completeUnitOfWork \u4f1a\u5c06 effectTag \u7684 Fiber \u8282\u70b9\u4f1a\u88ab\u4fdd\u5b58\u5728\u4e00\u6761\u88ab\u79f0\u4e3a effectList \u7684\u5355\u5411\u94fe\u8868\u4e2d\u3002\u5728 commit \u9636\u6bb5\uff0c\u5c06\u4e0d\u518d\u9700\u8981\u904d\u5386\u6bcf\u4e00\u4e2a fiber \uff0c\u53ea\u9700\u8981\u6267\u884c\u66f4\u65b0 effectList \u5c31\u53ef\u4ee5\u4e86\u3002"),l.createElement("li",null,"completeWork \u9636\u6bb5\u5bf9\u4e8e\u7ec4\u4ef6\u5904\u7406 context \uff1b\u5bf9\u4e8e\u5143\u7d20\u6807\u7b7e\u521d\u59cb\u5316\uff0c\u4f1a\u521b\u5efa\u771f\u5b9e DOM \uff0c\u5c06\u5b50\u5b59 DOM \u8282\u70b9\u63d2\u5165\u521a\u751f\u6210\u7684 DOM \u8282\u70b9\u4e2d\uff1b\u4f1a\u89e6\u53d1 diffProperties \u5904\u7406 props \uff0c\u6bd4\u5982\u4e8b\u4ef6\u6536\u96c6\uff0cstyle\uff0cclassName \u5904\u7406\uff0c\u572815\u7ae0\u8bb2\u5230\u8fc7\u3002")),l.createElement("h4",{id:"\u8c03\u548c\u987a\u5e8f"},l.createElement(r.AnchorLink,{to:"#\u8c03\u548c\u987a\u5e8f","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u8c03\u548c\u987a\u5e8f"),l.createElement("p",null,"\u90a3\u4e48\u4e0a\u8ff0\u5199\u7684demo\u7247\u6bb5\uff0c\u5728\u521d\u59cb\u5316\u6216\u8005\u4e00\u6b21\u66f4\u65b0\u4e2d\u8c03\u548c\u987a\u5e8f\u662f\u600e\u6837\u7684\u5462\uff1f"),l.createElement("ul",null,l.createElement("li",null,"beginWork -> rootFiber"),l.createElement("li",null,"beginWork -> Index fiber"),l.createElement("li",null,"beginWork -> div fiber"),l.createElement("li",null,"beginWork -> hello,world fiber"),l.createElement("li",null,"completeWork -> hello,world fiber (completeWork\u8fd4\u56desibling)"),l.createElement("li",null,"beginWork -> p fiber"),l.createElement("li",null,"completeWork -> p fiber"),l.createElement("li",null,"beginWork -> button fiber"),l.createElement("li",null,"completeWork -> button fiber (\u6b64\u65f6\u6ca1\u6709sibling\uff0c\u8fd4\u56dereturn)"),l.createElement("li",null,"completeWork -> div fiber"),l.createElement("li",null,"completeWork -> Index fiber"),l.createElement("li",null,"completeWork -> rootFiber (\u5b8c\u6210\u6574\u4e2aworkLoop)")),l.createElement("blockquote",null,l.createElement("p",null,"\u6ca1\u6709 \u300aReact\u8fdb\u9636\u5b9e\u8df5\u6307\u5357\u300b \u548c \u70b9\u8d5e \u7684 \u6587\u672cfiber\u7684beginWork/completeWork\u6d41\u7a0b\uff0c\u662f\u56e0\u4e3a\u4f5c\u4e3a\u4e00\u79cd\u6027\u80fd\u4f18\u5316\u624b\u6bb5\uff0c\u9488\u5bf9\u53ea\u6709\u5355\u4e00\u6587\u672c\u5b50\u8282\u70b9\u7684Fiber\uff0cReact\u4f1a\u7279\u6b8a\u5904\u7406\u3002")),l.createElement("h3",{id:"2-commit\u9636\u6bb5"},l.createElement(r.AnchorLink,{to:"#2-commit\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"2 commit\u9636\u6bb5"),l.createElement("p",null,"\u65e2\u7136\u5b8c\u6210 render \u9636\u6bb5\uff0c\u63a5\u4e0b\u6765\u5c06\u8fdb\u884c\u7b2c\u4e8c\u9636\u6bb5 commit \u9636\u6bb5\u3002commit \u9636\u6bb5\u505a\u7684\u4e8b\u60c5\u662f\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u4e00\u65b9\u9762\u662f\u5bf9\u4e00\u4e9b\u751f\u547d\u5468\u671f\u548c\u526f\u4f5c\u7528\u94a9\u5b50\u7684\u5904\u7406\uff0c\u6bd4\u5982 componentDidMount \uff0c\u51fd\u6570\u7ec4\u4ef6\u7684 useEffect \uff0cuseLayoutEffect \uff1b"),l.createElement("li",null,"\u53e6\u4e00\u65b9\u9762\u5c31\u662f\u5728\u4e00\u6b21\u66f4\u65b0\u4e2d\uff0c\u6dfb\u52a0\u8282\u70b9\uff08 ",l.createElement("code",null,"Placement")," \uff09\uff0c\u66f4\u65b0\u8282\u70b9\uff08 ",l.createElement("code",null,"Update")," \uff09\uff0c\u5220\u9664\u8282\u70b9\uff08 ",l.createElement("code",null,"Deletion")," \uff09\uff0c\u8fd8\u6709\u5c31\u662f\u4e00\u4e9b\u7ec6\u8282\u7684\u5904\u7406\uff0c\u6bd4\u5982 ref \u7684\u5904\u7406\u3002")),l.createElement("p",null,"commit \u7ec6\u5206\u53ef\u4ee5\u5206\u4e3a\uff1a"),l.createElement("ul",null,l.createElement("li",null,l.createElement("code",null,"Before mutation")," \u9636\u6bb5\uff08\u6267\u884c DOM \u64cd\u4f5c\u524d\uff09\uff1b"),l.createElement("li",null,l.createElement("code",null,"mutation")," \u9636\u6bb5\uff08\u6267\u884c DOM \u64cd\u4f5c\uff09\uff1b"),l.createElement("li",null,l.createElement("code",null,"layout")," \u9636\u6bb5\uff08\u6267\u884c DOM \u64cd\u4f5c\u540e\uff09")),l.createElement("h4",{id:"-before-mutation"},l.createElement(r.AnchorLink,{to:"#-before-mutation","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u2460 Before mutation"),l.createElement("blockquote",null,l.createElement("p",null,"react-reconciler/src/ReactFiberWorkLoop.js")),l.createElement(c.Z,{code:"function commitBeforeMutationEffects() {\n  while (nextEffect !== null) {\n    const effectTag = nextEffect.effectTag;\n    if ((effectTag & Snapshot) !== NoEffect) {\n      const current = nextEffect.alternate;\n      // \u8c03\u7528getSnapshotBeforeUpdates\n      commitBeforeMutationEffectOnFiber(current, nextEffect);\n    }\n    if ((effectTag & Passive) !== NoEffect) {\n       scheduleCallback(NormalPriority, () => {\n          flushPassiveEffects();\n          return null;\n        });\n    }\n    nextEffect = nextEffect.nextEffect;\n  }\n}",lang:"js"}),l.createElement("p",null,"Before mutation \u9636\u6bb5\u505a\u7684\u4e8b\u4e3b\u8981\u6709\u4ee5\u4e0b\u5185\u5bb9\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u56e0\u4e3a Before mutation \u8fd8\u6ca1\u4fee\u6539\u771f\u5b9e\u7684 DOM \uff0c\u662f\u83b7\u53d6 DOM \u5feb\u7167\u7684\u6700\u4f73\u65f6\u671f\uff0c\u5982\u679c\u662f\u7c7b\u7ec4\u4ef6\u6709 getSnapshotBeforeUpdate \uff0c\u90a3\u4e48\u4f1a\u6267\u884c\u8fd9\u4e2a\u751f\u547d\u5468\u671f\u3002"),l.createElement("li",null,"\u4f1a\u5f02\u6b65\u8c03\u7528 useEffect \uff0c\u5728\u751f\u547d\u5468\u671f\u7ae0\u8282\u8bb2\u5230 useEffect \u662f\u91c7\u7528\u5f02\u6b65\u8c03\u7528\u7684\u6a21\u5f0f\uff0c\u5176\u76ee\u7684\u5c31\u662f\u9632\u6b62\u540c\u6b65\u6267\u884c\u65f6\u963b\u585e\u6d4f\u89c8\u5668\u505a\u89c6\u56fe\u6e32\u67d3\u3002")),l.createElement("h4",{id:"-mutation"},l.createElement(r.AnchorLink,{to:"#-mutation","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u2461 Mutation"),l.createElement(c.Z,{code:"function commitMutationEffects(){\n    while (nextEffect !== null) {\n        if (effectTag & Ref) { /* \u7f6e\u7a7aRef */\n            const current = nextEffect.alternate;\n            if (current !== null) {\n                commitDetachRef(current);\n            }\n        }\n        switch (primaryEffectTag) {\n            case Placement: {} //  \u65b0\u589e\u5143\u7d20\n            case Update:{}     //  \u66f4\u65b0\u5143\u7d20\n            case Deletion:{}   //  \u5220\u9664\u5143\u7d20\n        }\n    } \n}",lang:"js"}),l.createElement("p",null,"mutation \u9636\u6bb5\u505a\u7684\u4e8b\u60c5\u6709\uff1a"),l.createElement("ul",null,l.createElement("li",null,"\u7f6e\u7a7a ref \uff0c\u5728 ref \u7ae0\u8282\u8bb2\u5230\u5bf9\u4e8e ref \u7684\u5904\u7406\u3002"),l.createElement("li",null,"\u5bf9\u65b0\u589e\u5143\u7d20\uff0c\u66f4\u65b0\u5143\u7d20\uff0c\u5220\u9664\u5143\u7d20\u3002\u8fdb\u884c\u771f\u5b9e\u7684 DOM \u64cd\u4f5c\u3002")),l.createElement("h4",{id:"-layout"},l.createElement(r.AnchorLink,{to:"#-layout","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u2462 Layout"),l.createElement(c.Z,{code:"function commitLayoutEffects(root){\n     while (nextEffect !== null) {\n          const effectTag = nextEffect.effectTag;\n          commitLayoutEffectOnFiber(root,current,nextEffect,committedExpirationTime)\n          if (effectTag & Ref) {\n             commitAttachRef(nextEffect);\n          }\n     }\n}",lang:"js"}),l.createElement("p",null,"Layout \u9636\u6bb5 DOM \u5df2\u7ecf\u66f4\u65b0\u5b8c\u6bd5\uff0cLayout \u505a\u7684\u4e8b\u60c5\u6709\uff1a"),l.createElement("ul",null,l.createElement("li",null,"commitLayoutEffectOnFiber \u5bf9\u4e8e\u7c7b\u7ec4\u4ef6\uff0c\u4f1a\u6267\u884c\u751f\u547d\u5468\u671f\uff0csetState \u7684callback\uff0c\u5bf9\u4e8e\u51fd\u6570\u7ec4\u4ef6\u4f1a\u6267\u884c useLayoutEffect \u94a9\u5b50\u3002"),l.createElement("li",null,"\u5982\u679c\u6709 ref \uff0c\u4f1a\u91cd\u65b0\u8d4b\u503c ref \u3002")),l.createElement("p",null,"\u63a5\u4e0b\u6765\u5bf9 commit \u9636\u6bb5\u505a\u4e00\u4e2a\u603b\u7ed3\uff0c\u4e3b\u8981\u505a\u7684\u4e8b\u5c31\u662f\u6267\u884ceffectList\uff0c\u66f4\u65b0DOM\uff0c\u6267\u884c\u751f\u547d\u5468\u671f\uff0c\u83b7\u53d6ref\u7b49\u64cd\u4f5c\u3002"),l.createElement("h3",{id:"3-\u8c03\u548c--\u5f02\u6b65\u8c03\u5ea6-\u6d41\u7a0b\u603b\u56fe"},l.createElement(r.AnchorLink,{to:"#3-\u8c03\u548c--\u5f02\u6b65\u8c03\u5ea6-\u6d41\u7a0b\u603b\u56fe","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"3 \u8c03\u548c + \u5f02\u6b65\u8c03\u5ea6 \u6d41\u7a0b\u603b\u56fe"),l.createElement("p",null,"\u628a\u4e0a\u4e00\u7ae0\u8282\u548c\u672c\u7ae0\u8282\u4e32\u8054\u8d77\u6765\uff0c\u8c03\u548c\u8c03\u5ea6\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a"),l.createElement("p",null,l.createElement("img",{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/429a103a732e42b69b6cd9a32f1d265a~tplv-k3u1fbpfcp-watermark.awebp",alt:"3.jpeg"})),l.createElement("h2",{id:"\u4e94-\u603b\u7ed3"},l.createElement(r.AnchorLink,{to:"#\u4e94-\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},l.createElement("span",{className:"icon icon-link"})),"\u4e94 \u603b\u7ed3"),l.createElement("p",null,"\u8fd9\u8282\u4e3b\u8981\u4ecb\u7ecd\u4e86\uff1a"),l.createElement("ul",null,l.createElement("li",null,"fiber \u7684\u8bde\u751f\u7684\u521d\u8877\uff0c\u4ee5\u53ca fiber \u7ec4\u6210\uff0c\u4e0d\u540c\u79cd\u7c7b\u7684 fiber \uff0cfiber \u5982\u4f55\u5efa\u7acb\u8d77\u8054\u7cfb\u3002"),l.createElement("li",null,"fiber \u7684\u66f4\u65b0\u673a\u5236\uff0c\u53cc\u7f13\u51b2\u6811\u3002"),l.createElement("li",null,"reconciler \u8c03\u548c\u8fc7\u7a0b\uff0c\u4ee5\u53ca render \u548c commit \u4e24\u5927\u9636\u6bb5\u3002"))))}));t["default"]=e=>{var t=l.useContext(r.context),n=t.demos;return l.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&r.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.createElement(a,{demos:n})}}}]);